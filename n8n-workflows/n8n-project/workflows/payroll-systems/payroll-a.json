{
  "nodes": [
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "gpt-4o-mini",
          "mode": "list",
          "cachedResultName": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        16,
        512
      ],
      "id": "19e40af5-693c-4606-8072-b0d28a59ebe2",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "ZFmQNyo0kSoO9TXC",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.text }}",
        "messages": {
          "messageValues": [
            {
              "message": "=ë‹¹ì‹ ì€ ê¸‰ì—¬ ë³€ë™ì‚¬í•­ í…ìŠ¤íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ êµ¬ì¡°í™”ëœ JSON ë°ì´í„°ë¡œ ë³€í™˜í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.\n\në¶„ì„ ê·œì¹™:\n1. ì§ì›ëª…, ë§¤ì¥ëª…, ê·¼ë¬´ ìœ í˜•, ì‹œê°„/ì¼ìˆ˜ë¥¼ ì •í™•íˆ ì¶”ì¶œ\n2. \"ë³€ë™ì‚¬í•­ ì—†ìŒ\" ê²½ìš°ì—ë„ ë°˜ë“œì‹œ 1ê°œ ë ˆì½”ë“œ ìƒì„±\n3. detailsëŠ” í•µì‹¬ ë‚´ìš©ë§Œ ê°„ë‹¨íˆ (50ì ì´ë‚´)\n4. ì›ë³¸ ìš”ì²­ ë©”ì¼ ë‚´ìš©ì€ ì œì™¸\n5. null, undefined ì ˆëŒ€ ê¸ˆì§€\n\në³€ë™ì‚¬í•­ ì—†ìŒ ì²˜ë¦¬:\n- employee: \"ë³€ë™ì‚¬í•­ ì—†ìŒ\"\n- workType: \"ë³€ë™ì‚¬í•­ ì—†ìŒ\"  \n- hours: 0\n- days: 0\n- details: \"ë§¤ì¥ëª… ë³€ë™ì‚¬í•­ ì—†ìŒ\" (ê°„ë‹¨íˆ)\n- store: í•´ë‹¹ ë§¤ì¥ëª…\n\nì¶œë ¥ì€ ë°˜ë“œì‹œ ìˆœìˆ˜ JSONë§Œ:\n{\n  \"workRecords\": [\n    {\n      \"employee\": \"ì§ì›ëª…\",\n      \"workType\": \"ê·¼ë¬´ ìœ í˜•\",\n      \"hours\": 0,\n      \"days\": 0, \n      \"details\": \"ê°„ë‹¨í•œ ì„¤ëª…\",\n      \"store\": \"ë§¤ì¥ëª…\"\n    }\n  ]\n}"
            },
            {
              "type": "HumanMessagePromptTemplate",
              "message": "=ë‹¤ìŒ ì´ë©”ì¼ì—ì„œ ê·¼ë¬´ ë‚´ì—­ì„ ì¶”ì¶œí•´ì£¼ì„¸ìš”:  {{ $json.text }}"
            }
          ]
        },
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        -128,
        352
      ],
      "id": "5c436af9-cfd2-4520-9de3-3c69c582c121",
      "name": "Basic LLM Chain"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst results = [];\nconst currentDate = new Date();\nconst targetMonth = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}-01`;\n\nconst storeGroups = new Map();\n\nfor (const item of items) {\n  try {\n    let aiResponse = item.json.text;\n    \n    // ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì ì œê±°\n    aiResponse = aiResponse.replace(/\\\\\\\"/g, '\"');\n    aiResponse = aiResponse.replace(/\\\\\\\\/g, '\\\\');\n    \n    console.log('ì •ì œëœ JSON:', aiResponse);\n    \n    const parsedData = JSON.parse(aiResponse);\n    \n    // workRecords ë°°ì—´ ì²˜ë¦¬\n    for (const record of parsedData.workRecords) {\n      const storeName = record.store === \"null\" ? \"ë§¤ì¥ ë¯¸í™•ì¸\" : (record.store || \"ë§¤ì¥ ë¯¸í™•ì¸\");\n      \n      // ë§¤ì¥ë³„ë¡œ ê·¸ë£¹í•‘\n      if (!storeGroups.has(storeName)) {\n        storeGroups.set(storeName, []);\n      }\n      \n      const workRecord = {\n        employee: record.employee,\n        workType: record.workType,\n        hours: record.hours || null,\n        days: record.days || null,\n        details: record.details,\n        targetMonth: targetMonth\n      };\n      \n      storeGroups.get(storeName).push(workRecord);\n    }\n  } catch (error) {\n    console.error('JSON íŒŒì‹± ì˜¤ë¥˜:', error);\n  }\n}\n\n// ë§¤ì¥ë³„ë¡œ ì •ë¦¬ëœ ë°ì´í„° ìƒì„±\nfor (const [storeName, records] of storeGroups) {\n  results.push({\n    json: {\n      storeName: storeName,\n      targetMonth: targetMonth,\n      workRecords: records,\n      totalRecords: records.length\n    }\n  });\n}\n\nreturn results;"
      },
      "id": "ff98cc50-ceed-4e08-97fd-a5e99adfbbde",
      "name": "ë§¤ì¥ë³„ ë°ì´í„° ê·¸ë£¹í•‘",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        256,
        352
      ]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": "231d0f53-623d-8122-8c9d-ef51b3478957",
        "title": "={{ $json.targetMonth }} {{ $json.storeName }} ê·¼ë¬´ ë‚´ì—­ ({{ $json.totalRecords }}ê±´)",
        "simple": false,
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "ëŒ€ìƒì›”|date",
              "type": "date",
              "date": "=={{ $json.targetMonth }}"
            },
            {
              "key": "ìƒì„¸ë‚´ìš©|rich_text",
              "richText": true,
              "text": {
                "text": [
                  {
                    "text": "=[{{ $json.storeName }}] ê·¼ë¬´ ë‚´ì—­ ({{ $json.totalRecords }}ê±´):\n{{ $json.workRecords.map(r => {\n  if (r.employee === 'ë³€ë™ì‚¬í•­ ì—†ìŒ') {\n    return 'â€¢ ë³€ë™ì‚¬í•­ ì—†ìŒ';\n  } else {\n    const timeInfo = [];\n    if (r.hours > 0) timeInfo.push(r.hours + 'ì‹œê°„');\n    if (r.days > 0) timeInfo.push(r.days + 'ì¼');\n    const timeStr = timeInfo.length > 0 ? timeInfo.join(' ') : '';\n    return `â€¢ ${r.employee}${timeStr ? ': ' + timeStr : ''} - ${r.details}`;\n  }\n}).join('\\n') }}",
                    "annotationUi": {}
                  }
                ]
              }
            },
            {
              "key": "ì…ë ¥ ë‹´ë‹¹ì|rich_text",
              "richText": true,
              "text": {
                "text": [
                  {
                    "text": "={{ $json.storeName }} ë‹´ë‹¹ì",
                    "annotationUi": {}
                  }
                ]
              }
            }
          ]
        },
        "options": {}
      },
      "id": "5489f07b-e273-498f-97bf-d21f2ac9ee68",
      "name": "Notion DBì— ë§¤ì¥ë³„ ì €ì¥",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [
        480,
        352
      ],
      "credentials": {
        "notionApi": {
          "id": "kCKFfrau35Gf4PvW",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// HTML ë¦¬í¬íŠ¸ë¥¼ ë°”ì´ë„ˆë¦¬ ë°ì´í„°ë¡œ ë³€í™˜\nconst reportContent = $input.first().json.reportContent;\nconst fileName = $input.first().json.fileName;\n\n// HTMLì„ ë°”ì´ë„ˆë¦¬ë¡œ ë³€í™˜\nconst binaryData = Buffer.from(reportContent, 'utf8');\n\nreturn [{\n  json: $input.first().json,\n  binary: {\n    reportFile: {\n      data: binaryData.toString('base64'),\n      mimeType: 'text/html',\n      fileName: fileName,\n      fileExtension: 'html'\n    }\n  }\n}];"
      },
      "id": "85100217-b656-4c20-9ea9-7ef5a8d622f2",
      "name": "ë¦¬í¬íŠ¸ ë°”ì´ë„ˆë¦¬ ë³€í™˜",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        112,
        768
      ]
    },
    {
      "parameters": {
        "sendTo": "={{ $json.recipientEmail }}",
        "subject": "=[ì´ë¯¸ì»¤í”¼] {{ $json.targetMonthKorean }} ê¸‰ì—¬ ë³€ë™ì‚¬í•­ ì œì¶œ ìš”ì²­",
        "emailType": "text",
        "message": "=ì•ˆë…•í•˜ì„¸ìš”, {{ $json.recipientName }}ë‹˜.\n\n{{ $json.targetMonthKorean }} ê¸‰ì—¬ ê³„ì‚°ì„ ìœ„í•´ {{ $json.storeName }} ê´€ë ¨ ì•„ë˜ ê·¼ë¬´ ë‚´ì—­ì„ í™•ì¸í•˜ì—¬ íšŒì‹ í•´ ì£¼ì„¸ìš”.\n\nì œëª©ì— 'ê¸‰ì—¬ ë³€ë™ì‚¬í•­'ì„ ì¨ì£¼ì„¸ìš”.\n\nã€í™•ì¸ í•„ìš” ì‚¬í•­ã€‘\n1. íŒŒíŠ¸íƒ€ì´ë¨¸ ê·¼ë¬´ ì‹œê°„\n2. íœ´ì¼ ê·¼ë¬´ ì—¬ë¶€\n3. ì¶”ê°€ ê·¼ë¬´ ë‚´ì—­\n4. ê¸°íƒ€ íŠ¹ì´ì‚¬í•­ (íŒì—…í–‰ì‚¬ ì¼ìš©ì§ ê·¼ë¡œì ì‹ ê³ )\n\nã€íšŒì‹  í˜•ì‹ã€‘\nê° í•­ëª©ë³„ë¡œ í•´ë‹¹ ì‚¬í•­ì´ ìˆìœ¼ë©´ ì•„ë˜ í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•´ ì£¼ì„¸ìš”:\n\nâ–  íŒŒíŠ¸íƒ€ì´ë¨¸ ê·¼ë¬´ ì‹œê°„\n- ì§ì›ëª…: [ì´ë¦„]\n\nâ–  íœ´ì¼ ê·¼ë¬´\n- ì§ì›ëª…: [ì´ë¦„]\n- íœ´ì¼ ê·¼ë¬´: [ì¼ìˆ˜]ì¼\n- ìƒì„¸ë‚´ìš©: [ë‚ ì§œ ë° íœ´ì¼ëª…]\n\nâ–  ì¶”ê°€ ê·¼ë¬´\n- ì§ì›ëª…: [ì´ë¦„]\n- ì¶”ê°€ ê·¼ë¬´: [ì‹œê°„]ì‹œê°„\n- ìƒì„¸ë‚´ìš©: [ë‚ ì§œ ë° ì—…ë¬´ ë‚´ìš©]\n\nâ–  ê¸°íƒ€ íŠ¹ì´ì‚¬í•­\n- ì§ì›ëª…: [ì´ë¦„] (íŒì—…í–‰ì‚¬ ì¼ìš©ì§ ë“±)\n- ê·¼ë¬´ ê¸°ê°„: [ê¸°ê°„]\n- ìƒì„¸ë‚´ìš©: [êµ¬ì²´ì  ì—…ë¬´ ë‚´ìš©]\n\nã€ì‘ì„± ì˜ˆì‹œã€‘\nâ–  íŒŒíŠ¸íƒ€ì´ë¨¸ ê·¼ë¬´ ì‹œê°„\n- ì§ì›ëª…: í™ê¸¸ë™\n\nâ–  íœ´ì¼ ê·¼ë¬´\n- ì§ì›ëª…: ê¹€ì˜í¬\n- íœ´ì¼ ê·¼ë¬´: 1ì¼\n- ìƒì„¸ë‚´ìš©: 7/15 ê´‘ë³µì ˆ ê·¼ë¬´\n\nâ–  ì¶”ê°€ ê·¼ë¬´\n- ì§ì›ëª…: ì´ì² ìˆ˜\n- ì¶”ê°€ ê·¼ë¬´: 5ì‹œê°„\n- ìƒì„¸ë‚´ìš©: 7/25 ì•¼ê°„ ì—…ë¬´\n\nã€ì œì¶œ ë§ˆê°ì¼ã€‘\në§¤ì›” 27ì¼ê¹Œì§€ íšŒì‹  ë¶€íƒë“œë¦½ë‹ˆë‹¤.\n\ní•´ë‹¹ ì‚¬í•­ì´ ì—†ì„ ê²½ìš° \"{{ $json.storeName }} ë³€ë™ì‚¬í•­ ì—†ìŒ\"ì´ë¼ê³  íšŒì‹ í•´ ì£¼ì„¸ìš”.\n\nê°ì‚¬í•©ë‹ˆë‹¤.\n\nì´ë¯¸ì»¤í”¼ ê´€ë¦¬íŒ€\nhovooimi@gmail.com",
        "options": {}
      },
      "id": "64d593e1-d3f8-4682-8b19-491c1549d460",
      "name": "ë³€ë™ì‚¬í•­ ìš”ì²­ ì´ë©”ì¼ ë°œì†¡1",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        112,
        48
      ],
      "webhookId": "4ef83d60-3b60-46e9-9daf-085cd1ebde25",
      "credentials": {
        "gmailOAuth2": {
          "id": "n735fVjFPAKUNivZ",
          "name": "hovoo Gmail account"
        }
      }
    },
    {
      "parameters": {
        "operation": "getAll",
        "simple": false,
        "filters": {
          "q": "=to:hovooimi@gmail.com subject:ê¸‰ì—¬ ë³€ë™ì‚¬í•­ after:{{ $now.minus({ days: 5 }).toFormat('yyyy/MM/dd') }}"
        },
        "options": {}
      },
      "id": "f39b11af-7dc4-49a3-ad60-e2deabc55547",
      "name": "ë³€ë™ì‚¬í•­ íšŒì‹  ì´ë©”ì¼ ìˆ˜ì§‘1",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -336,
        352
      ],
      "webhookId": "ecd601a4-0e0b-4ec2-b802-60cf7fa7d29b",
      "credentials": {
        "gmailOAuth2": {
          "id": "n735fVjFPAKUNivZ",
          "name": "hovoo Gmail account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "231d0f53-623d-8122-8c9d-ef51b3478957",
          "mode": "list",
          "cachedResultName": "[ê¸‰ì—¬ìë™í™”] ì›”ë³„ ê¸‰ì—¬ ë³€ë™ DB",
          "cachedResultUrl": "https://www.notion.so/231d0f53623d81228c9def51b3478957"
        },
        "simple": false,
        "filterType": "manual",
        "matchType": "allFilters",
        "filters": {
          "conditions": [
            {
              "key": "ëŒ€ìƒì›”|date",
              "condition": "equals",
              "date": "=={{ $now.toFormat('yyyy-MM') }}-01"
            }
          ]
        },
        "options": {}
      },
      "id": "6fff7b0c-e8bd-4f5f-9a11-93007404e539",
      "name": "ì›”ë³„ ë³€ë™ì‚¬í•­ ì·¨í•©1",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [
        -336,
        768
      ],
      "credentials": {
        "notionApi": {
          "id": "kCKFfrau35Gf4PvW",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "sendTo": "naeil08@hanmail.net",
        "subject": "=[ì´ë¯¸ì»¤í”¼] {{ $json.targetMonth }} ê¸‰ì—¬ ë³€ë™ì‚¬í•­ ì „ë‹¬",
        "emailType": "text",
        "message": "=ì•ˆë…•í•˜ì„¸ìš”.\n\n{{ $json.targetMonth }} ê¸‰ì—¬ ë³€ë™ì‚¬í•­ì„ ì •ë¦¬í•˜ì—¬ ì „ë‹¬ë“œë¦½ë‹ˆë‹¤.\n\nã€ë³€ë™ì‚¬í•­ ìš”ì•½ã€‘\n- ì´ ë§¤ì¥ ë°ì´í„°: {{ $json.totalEntries }}ê°œ\n- ìˆ˜ì§‘ ê¸°ê°„: ë§¤ì›” 25ì¼~27ì¼\n- ë°ì´í„° í˜•íƒœ: ë§¤ì¥ë³„ ê·¼ë¬´ ë‚´ì—­ ì •ë¦¬\n\nì²¨ë¶€ëœ íŒŒì¼ì„ í™•ì¸í•˜ì‹œì–´ ê¸‰ì—¬ ê³„ì‚°ì— ë°˜ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤.\nê°œë³„ ì§ì› í™•ì¸ì´ í•„ìš”í•œ ê²½ìš° ì—°ë½ ì£¼ì‹œë©´ ìƒì„¸ ì •ë³´ ì œê³µí•˜ê² ìŠµë‹ˆë‹¤.\n\nê°ì‚¬í•©ë‹ˆë‹¤.\n\nì´ë¯¸ì»¤í”¼ ê´€ë¦¬íŒ€\nhovooimi@gmail.com",
        "options": {
          "attachmentsUi": {
            "attachmentsBinary": [
              {
                "property": "reportFile"
              }
            ]
          }
        }
      },
      "id": "b39300c7-29cc-4eda-83b7-37e2d9eef33a",
      "name": "ë…¸ë¬´ì‚¬ ì „ë‹¬",
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        336,
        768
      ],
      "webhookId": "636ae9b2-6e48-497e-9e88-a098e0f87e0c",
      "credentials": {
        "gmailOAuth2": {
          "id": "n735fVjFPAKUNivZ",
          "name": "hovoo Gmail account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ì·¨í•©ëœ ë°ì´í„°ë¥¼ ë…¸ë¬´ì‚¬ìš© HTML ë¦¬í¬íŠ¸ í˜•ì‹ìœ¼ë¡œ ê°€ê³µ\nconst items = $input.all();\nconst currentDate = new Date();\nconst targetMonth = `${currentDate.getFullYear()}ë…„ ${currentDate.getMonth() + 1}ì›”`;\n\n// HTML ë¦¬í¬íŠ¸ ìƒì„±\nlet htmlContent = `<!DOCTYPE html>\n<html lang=\"ko\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${targetMonth} IMI COFFEE ê¸‰ì—¬ ë³€ë™ì‚¬í•­ ë¦¬í¬íŠ¸</title>\n    <style>\n        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap');\n        \n        body { \n            font-family: 'Noto Sans KR', 'Malgun Gothic', Arial, sans-serif; \n            line-height: 1.6; \n            margin: 0; \n            padding: 40px; \n            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);\n            color: #333;\n        }\n        \n        .container { \n            max-width: 900px; \n            margin: 0 auto; \n            background: white; \n            border-radius: 16px; \n            overflow: hidden;\n            box-shadow: 0 10px 40px rgba(0,0,0,0.1);\n        }\n        \n        .header { \n            background: linear-gradient(135deg, #3D2914 0%, #5D3E23 100%);\n            color: white;\n            text-align: center; \n            padding: 40px 30px;\n            position: relative;\n        }\n        \n        .header::before {\n            content: '';\n            position: absolute;\n            top: 0;\n            left: 0;\n            right: 0;\n            bottom: 0;\n            background: url('data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 100 100\"><circle cx=\"20\" cy=\"20\" r=\"2\" fill=\"rgba(255,255,255,0.1)\"/><circle cx=\"80\" cy=\"40\" r=\"1.5\" fill=\"rgba(255,255,255,0.08)\"/><circle cx=\"40\" cy=\"80\" r=\"1\" fill=\"rgba(255,255,255,0.06)\"/></svg>');\n        }\n        \n        .logo { \n            font-size: 32px; \n            font-weight: 700; \n            letter-spacing: 2px;\n            margin-bottom: 8px;\n            position: relative;\n            z-index: 1;\n        }\n        \n        .header h1 { \n            font-size: 24px; \n            font-weight: 500; \n            margin: 0;\n            opacity: 0.95;\n            position: relative;\n            z-index: 1;\n        }\n        \n        .header p { \n            margin: 8px 0 0 0; \n            opacity: 0.8;\n            font-size: 16px;\n            position: relative;\n            z-index: 1;\n        }\n        \n        .summary { \n            background: #f8f8f8; \n            padding: 30px; \n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n            gap: 20px;\n            border-bottom: 1px solid #e0e0e0;\n        }\n        \n        .summary-item { \n            background: white;\n            padding: 20px;\n            border-radius: 12px;\n            text-align: center;\n            box-shadow: 0 2px 8px rgba(0,0,0,0.06);\n            border-left: 4px solid #3D2914;\n        }\n        \n        .summary-item .emoji { \n            font-size: 24px; \n            display: block;\n            margin-bottom: 8px;\n        }\n        \n        .summary-item strong { \n            color: #3D2914; \n            font-weight: 600;\n            display: block;\n            margin-bottom: 4px;\n        }\n        \n        .summary-item .value {\n            font-size: 18px;\n            font-weight: 500;\n            color: #5D3E23;\n        }\n        \n        .items {\n            padding: 30px;\n        }\n        \n        .item { \n            border: 1px solid #e8e8e8;\n            border-radius: 12px;\n            padding: 25px; \n            margin: 20px 0; \n            background: #fdfdfd;\n            transition: all 0.3s ease;\n        }\n        \n        .item:hover {\n            box-shadow: 0 5px 15px rgba(61, 41, 20, 0.1);\n            transform: translateY(-2px);\n        }\n        \n        .item h3 { \n            color: #3D2914; \n            margin: 0 0 15px 0; \n            font-size: 20px;\n            font-weight: 600;\n            padding-bottom: 10px;\n            border-bottom: 2px solid #f0f0f0;\n        }\n        \n        .item-details { \n            display: grid;\n            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n            gap: 15px;\n            margin-bottom: 20px;\n            font-size: 14px;\n        }\n        \n        .item-details span { \n            background: #f8f8f8;\n            padding: 8px 12px;\n            border-radius: 8px;\n            color: #666;\n        }\n        \n        .item-content { \n            background: #f9f9f9; \n            padding: 20px; \n            border-radius: 10px; \n            border-left: 4px solid #3D2914;\n            color: #333;\n            font-size: 15px;\n            line-height: 1.8;\n        }\n        \n        .footer { \n            background: #f8f8f8;\n            padding: 30px; \n            border-top: 1px solid #e0e0e0;\n        }\n        \n        .footer h3 { \n            color: #3D2914; \n            margin-bottom: 20px; \n            font-size: 18px;\n            font-weight: 600;\n        }\n        \n        .footer ul { \n            color: #666; \n            padding-left: 0;\n            list-style: none;\n        }\n        \n        .footer li { \n            margin-bottom: 12px; \n            padding-left: 20px;\n            position: relative;\n        }\n        \n        .footer li::before {\n            content: 'âœ“';\n            position: absolute;\n            left: 0;\n            color: #3D2914;\n            font-weight: bold;\n        }\n        \n        .contact { \n            background: linear-gradient(135deg, #3D2914 0%, #5D3E23 100%);\n            color: white;\n            padding: 20px; \n            border-radius: 12px; \n            margin-top: 25px;\n        }\n        \n        .contact strong { \n            color: #fff;\n            font-weight: 600;\n        }\n        \n        .status-pending { \n            color: #D2691E; \n            font-weight: 600; \n        }\n        \n        .emoji { \n            font-size: 16px; \n            margin-right: 8px; \n        }\n        \n        @media (max-width: 768px) {\n            body { padding: 20px; }\n            .header { padding: 30px 20px; }\n            .logo { font-size: 28px; }\n            .header h1 { font-size: 20px; }\n            .summary { grid-template-columns: 1fr; }\n            .item-details { grid-template-columns: 1fr; }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <div class=\"header\">\n            <div class=\"logo\">IMI COFFEE</div>\n            <h1>${targetMonth} ê¸‰ì—¬ ë³€ë™ì‚¬í•­ ë¦¬í¬íŠ¸</h1>\n            <p>ê¸‰ì—¬ ì •ì‚°ì„ ìœ„í•œ ë³€ë™ì‚¬í•­ ë³´ê³ ì„œ</p>\n        </div>\n        \n        <div class=\"summary\">\n            <div class=\"summary-item\">\n                <span class=\"emoji\">ğŸ“…</span>\n                <strong>ë³´ê³  ê¸°ê°„</strong>\n                <div class=\"value\">${targetMonth}</div>\n            </div>\n            <div class=\"summary-item\">\n                <span class=\"emoji\">ğŸ“Š</span>\n                <strong>ì´ ë°ì´í„° ìˆ˜</strong>\n                <div class=\"value\">${items.length}ê°œ</div>\n            </div>\n            <div class=\"summary-item\">\n                <span class=\"emoji\">ğŸ“§</span>\n                <strong>ë‹´ë‹¹ ë¶€ì„œ</strong>\n                <div class=\"value\">ì´ë¯¸ì»¤í”¼ ê´€ë¦¬íŒ€</div>\n            </div>\n        </div>\n        \n        <div class=\"items\">`;\n\n// ê° í•­ëª©ë³„ ë°ì´í„° ì •ë¦¬\nitems.forEach((item, index) => {\n  const data = item.json;\n  \n  // propertiesì—ì„œ ì œëª©ê³¼ ìƒì„¸ë‚´ìš© ì¶”ì¶œ\n  const title = data.properties?.['ë³€ë™ ë‚´ì—­ ìš”ì•½']?.title?.[0]?.plain_text || `ê¸‰ì—¬ ë³€ë™ì‚¬í•­ ${index + 1}`;\n  let content = data.properties?.['ìƒì„¸ë‚´ìš©']?.rich_text?.[0]?.plain_text || \"ë‚´ìš© ì—†ìŒ\";\n  const store = data.properties?.['ì…ë ¥ ë‹´ë‹¹ì']?.rich_text?.[0]?.plain_text || \"ë‹´ë‹¹ì ë¯¸í™•ì¸\";\n  \n  // ì´ìŠ¤ì¼€ì´í”„ ë¬¸ì ì²˜ë¦¬\n  content = content.replace(/\\\\n/g, '<br>');\n  content = content.replace(/\\n/g, '<br>');\n  \n  htmlContent += `\n            <div class=\"item\">\n                <h3>${index + 1}. ${title}</h3>\n                <div class=\"item-details\">\n                    <span><span class=\"emoji\">ğŸª</span>ë‹´ë‹¹ì: ${store}</span>\n                    <span><span class=\"emoji\">ğŸ“…</span>ë“±ë¡ì¼: ${currentDate.toLocaleDateString('ko-KR')}</span>\n                    <span><span class=\"emoji\">â³</span>ìƒíƒœ: <span class=\"status-pending\">í™•ì¸ í•„ìš”</span></span>\n                </div>\n                <div class=\"item-content\">\n                    ${content}\n                </div>\n            </div>`;\n});\n\nhtmlContent += `\n        </div>\n        \n        <div class=\"footer\">\n            <h3><span class=\"emoji\">ğŸ“</span>ì²˜ë¦¬ ì•ˆë‚´</h3>\n            <ul>\n                <li>ê° í•­ëª©ë³„ë¡œ ê¸‰ì—¬ ê³„ì‚° í›„ ë°˜ì˜ ë¶€íƒë“œë¦½ë‹ˆë‹¤</li>\n                <li>ì¶”ê°€ í™•ì¸ì´ í•„ìš”í•œ ê²½ìš° ì–¸ì œë“ ì§€ ì—°ë½ ì£¼ì„¸ìš”</li>\n                <li>ë‹¤ìŒ ë‹¬ ì²˜ë¦¬ë¥¼ ìœ„í•´ ë§¤ì›” 28ì¼ ìë™ ë°œì†¡ë©ë‹ˆë‹¤</li>\n            </ul>\n            \n            <div class=\"contact\">\n                <strong><span class=\"emoji\">ğŸ“</span>ë¬¸ì˜:</strong> hovooimi@gmail.com<br>\n                <strong><span class=\"emoji\">ğŸ“…</span>ë°œì†¡ì¼:</strong> ${currentDate.toLocaleDateString('ko-KR')} ${currentDate.toLocaleTimeString('ko-KR')}\n            </div>\n        </div>\n    </div>\n</body>\n</html>`;\n\nreturn [{\n  json: {\n    reportContent: htmlContent,\n    targetMonth: targetMonth,\n    totalEntries: items.length,\n    fileName: `IMI_COFFEE_ê¸‰ì—¬ë³€ë™ì‚¬í•­_ë¦¬í¬íŠ¸_${currentDate.getFullYear()}${String(currentDate.getMonth() + 1).padStart(2, '0')}.html`\n  }\n}];"
      },
      "id": "b096c844-9e15-479f-accc-5d43c44fd2af",
      "name": "ë…¸ë¬´ì‚¬ìš© ë¦¬í¬íŠ¸ ìƒì„±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        768
      ]
    },
    {
      "parameters": {
        "jsCode": "const managers = $input.all();\nconst emailData = [];\n\nconst now = new Date();\nconst targetMonth = `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}`;\nconst targetMonthKorean = `${now.getFullYear()}ë…„ ${now.getMonth() + 1}ì›”`;\n\nfor (const manager of managers) {\n  try {\n    const properties = manager.json.properties || {};\n    \n    // ì›ë³¸ Notion ë°ì´í„° êµ¬ì¡°ì—ì„œ ì¶”ì¶œ\n    const employeeName = \n      properties['ì§ì›ëª…']?.title?.[0]?.text?.content ||\n      properties['ì§ì›ëª…']?.title?.[0]?.plain_text ||\n      'ì´ë¦„ ì—†ìŒ';\n    \n    const email = \n      properties['ì´ë©”ì¼']?.email ||\n      'no-email@imicoffee.com';\n    \n    const storeName = \n      properties['ì†Œì†ë§¤ì¥']?.select?.name ||\n      'ë§¤ì¥ ì—†ìŒ';\n    \n    const position = \n      properties['ì§ê¸‰']?.select?.name ||\n      'ì§ê¸‰ ì—†ìŒ';\n    \n    const workStatus = \n      properties['ì¬ì§ìƒíƒœ']?.select?.name ||\n      'ìƒíƒœ ì—†ìŒ';\n    \n    // ì¬ì§ ì¤‘ì¸ ì ì¥, íŒ€ì¥ë§Œ í•„í„°ë§\n    if (workStatus === 'ì¬ì§' && (position === 'ì ì¥' || position === 'íŒ€ì¥')) {\n      emailData.push({\n        recipientEmail: email,\n        recipientName: employeeName,\n        storeName: storeName,\n        position: position,\n        targetMonth: targetMonth,\n        targetMonthKorean: targetMonthKorean,\n        managerId: manager.json.id\n      });\n    }\n    \n    console.log(`ì²´í¬: ${employeeName} - ${email} - ${storeName} - ${position} - ${workStatus}`);\n    \n  } catch (error) {\n    console.error('ë°ì´í„° ì²˜ë¦¬ ì˜¤ë¥˜:', error);\n  }\n}\n\nconsole.log(`ì´ ${emailData.length}ëª…ì˜ ì ì¥/íŒ€ì¥ ë°ì´í„° ì¶”ì¶œ`);\nreturn emailData.map(data => ({ json: data }));"
      },
      "id": "dadaddf6-a7dd-4d21-b96d-f5388b0cc121",
      "name": "ì´ë©”ì¼ ë°ì´í„° ì¤€ë¹„",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -112,
        48
      ]
    },
    {
      "parameters": {
        "content": "## ê° ë§¤ì¥ ë³€ë™ì‚¬í•­ ìš”ì²­ ì´ë©”ì¼ ë³´ë‚´ê¸° (ë§¤ì›”25ì¼ 5ì‹œ)",
        "height": 320,
        "width": 1360
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -640,
        -96
      ],
      "typeVersion": 1,
      "id": "b29c2176-86dd-4ffd-9baf-880901ee6543",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## íšŒì‹  ë©”ì¼ ì •ë¦¬í•´ì„œ Notionì— ìë™ ì €ì¥ (ë§¤ì›” 28ì¼ 10ì‹œ)",
        "height": 352,
        "width": 1360,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -640,
        272
      ],
      "typeVersion": 1,
      "id": "e79cda51-dcb0-487a-b4f4-b3a83d03342b",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## ìµœì¢… ë¦¬í¬íŠ¸ ìë™ ìƒì„± ë° ë…¸ë¬´ì‚¬ì—ê²Œ ì´ë©”ì¼ ë°œì†¡ (ë§¤ì›” 28ì¼ 11ì‹œ)",
        "height": 304,
        "width": 1360,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -640,
        672
      ],
      "typeVersion": 1,
      "id": "4acfef4c-76e0-4ae6-a6f8-b9b7f83864fa",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "months",
              "triggerAtDayOfMonth": 25,
              "triggerAtHour": 17
            }
          ]
        }
      },
      "id": "bde864eb-7aca-4b14-bd06-40fefb6ed820",
      "name": "ë§¤ì›” 25ì¼ 5ì‹œ íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -544,
        48
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "months",
              "triggerAtDayOfMonth": 28,
              "triggerAtHour": 22
            }
          ]
        }
      },
      "id": "ab27b89f-782f-4273-9a43-ecc848e42d4e",
      "name": "ë§¤ì›” 28ì¼ 10ì‹œ íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -544,
        352
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "months",
              "triggerAtDayOfMonth": 28,
              "triggerAtHour": 23
            }
          ]
        }
      },
      "id": "a23d681e-c7bf-48c8-972e-62a2d1195eb8",
      "name": "ë§¤ì›” 28ì¼ 11ì‹œ íŠ¸ë¦¬ê±°",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        -544,
        768
      ]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "getAll",
        "databaseId": {
          "__rl": true,
          "value": "231d0f53-623d-81ea-aca9-dfb9547d41f9",
          "mode": "list",
          "cachedResultName": "[HR] ì§ì› ê´€ë¦¬ DB",
          "cachedResultUrl": "https://www.notion.so/231d0f53623d81eaaca9dfb9547d41f9"
        },
        "simple": false,
        "filterType": "manual",
        "filters": {
          "conditions": [
            {
              "key": "ì§ê¸‰|select",
              "condition": "equals",
              "selectValue": "ì ì¥"
            },
            {
              "key": "ì§ê¸‰|select",
              "condition": "equals",
              "selectValue": "íŒ€ì¥"
            },
            {
              "key": "ì§ê¸‰|select",
              "condition": "equals",
              "selectValue": "ë¶€ëŒ€í‘œ"
            }
          ]
        },
        "options": {}
      },
      "id": "11170f73-4e1a-497a-b8da-3fe4a9ccd72a",
      "name": "ì ì¥Â·íŒ€ì¥ ì •ë³´ ì¡°íšŒ",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2,
      "position": [
        -336,
        48
      ],
      "credentials": {
        "notionApi": {
          "id": "kCKFfrau35Gf4PvW",
          "name": "Notion account"
        }
      }
    }
  ],
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Basic LLM Chain": {
      "main": [
        [
          {
            "node": "ë§¤ì¥ë³„ ë°ì´í„° ê·¸ë£¹í•‘",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë§¤ì¥ë³„ ë°ì´í„° ê·¸ë£¹í•‘": {
      "main": [
        [
          {
            "node": "Notion DBì— ë§¤ì¥ë³„ ì €ì¥",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë¦¬í¬íŠ¸ ë°”ì´ë„ˆë¦¬ ë³€í™˜": {
      "main": [
        [
          {
            "node": "ë…¸ë¬´ì‚¬ ì „ë‹¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë³€ë™ì‚¬í•­ íšŒì‹  ì´ë©”ì¼ ìˆ˜ì§‘1": {
      "main": [
        [
          {
            "node": "Basic LLM Chain",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì›”ë³„ ë³€ë™ì‚¬í•­ ì·¨í•©1": {
      "main": [
        [
          {
            "node": "ë…¸ë¬´ì‚¬ìš© ë¦¬í¬íŠ¸ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë…¸ë¬´ì‚¬ìš© ë¦¬í¬íŠ¸ ìƒì„±": {
      "main": [
        [
          {
            "node": "ë¦¬í¬íŠ¸ ë°”ì´ë„ˆë¦¬ ë³€í™˜",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì´ë©”ì¼ ë°ì´í„° ì¤€ë¹„": {
      "main": [
        [
          {
            "node": "ë³€ë™ì‚¬í•­ ìš”ì²­ ì´ë©”ì¼ ë°œì†¡1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë§¤ì›” 25ì¼ 5ì‹œ íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "ì ì¥Â·íŒ€ì¥ ì •ë³´ ì¡°íšŒ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë§¤ì›” 28ì¼ 10ì‹œ íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "ë³€ë™ì‚¬í•­ íšŒì‹  ì´ë©”ì¼ ìˆ˜ì§‘1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë§¤ì›” 28ì¼ 11ì‹œ íŠ¸ë¦¬ê±°": {
      "main": [
        [
          {
            "node": "ì›”ë³„ ë³€ë™ì‚¬í•­ ì·¨í•©1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì ì¥Â·íŒ€ì¥ ì •ë³´ ì¡°íšŒ": {
      "main": [
        [
          {
            "node": "ì´ë©”ì¼ ë°ì´í„° ì¤€ë¹„",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "503b3d8b44115e5921e2e4e1edcde177dde00c303a77361802e2da13d7103e31"
  },
  "name": "ê¸‰ì—¬ ë³€ë™ì‚¬í•­ ìˆ˜ì§‘ ë° ë…¸ë¬´ì‚¬ ë¦¬í¬íŠ¸ (Payroll A)",
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "12a34567-89ab-cdef-0123-456789abcdef",
  "id": "99",
  "tags": [
    {
      "createdAt": "2024-12-15T10:30:00.000Z",
      "updatedAt": "2024-12-15T10:30:00.000Z",
      "id": "17",
      "name": "ê¸‰ì—¬ê´€ë¦¬"
    },
    {
      "createdAt": "2024-12-15T10:30:00.000Z", 
      "updatedAt": "2024-12-15T10:30:00.000Z",
      "id": "18",
      "name": "HRìë™í™”"
    }
  ]
}