{
  "name": "YouTube Blog Complete Final",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "youtube-blog-complete-final",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "webhook-trigger",
      "name": "Webhook Trigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        16,
        304
      ],
      "webhookId": "5eba58f3-359d-4609-833c-7a5431b20d89"
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "get",
        "pageId": {
          "__rl": true,
          "value": "={{ $json.body.pageId }}",
          "mode": "id"
        }
      },
      "id": "get-video-info",
      "name": "Get Video Info from Notion",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        240,
        304
      ],
      "credentials": {
        "notionApi": {
          "id": "kCKFfrau35Gf4PvW",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "  // YouTube URL에서 video ID 추출\n  const items = $input.all();\n  const results = [];\n\n  for (const item of items) {\n    try {\n      // Notion 페이지에서 YouTube URL 추출 (수정된 부분)\n      let youtubeUrl = '';\n\n      // 직접 property_url에서 가져오기\n      if (item.json.property_url) {\n        youtubeUrl = item.json.property_url;\n      }\n      // 기존 구조도 지원\n      else if (item.json.properties?.URL?.url) {\n        youtubeUrl = item.json.properties.URL.url;\n      } else if (item.json.properties?.url?.url) {\n        youtubeUrl = item.json.properties.url.url;\n      }\n\n      if (!youtubeUrl) {\n        throw new Error('YouTube URL을 찾을 수 없습니다.');\n      }\n\n      // YouTube video ID 추출\n      let videoId = '';\n      const match = youtubeUrl.match(/(?:youtube\\.com\\/watch\\?v=|youtu\\.be\\/)([^&\\n?#]+)/);\n      if (match && match[1]) {\n        videoId = match[1];\n      }\n\n      if (!videoId) {\n        throw new Error('유효한 YouTube video ID를 추출할 수 없습니다.');\n      }\n\n      // 제목과 채널명 안전하게 추출 (수정된 부분)\n      let title = '제목 없음';\n      if (item.json.property_) {\n        title = item.json.property_;\n      } else if (item.json.name) {\n        title = item.json.name;\n      }\n\n      let channelName = '채널명 없음';\n      if (item.json.property_rss) {\n        channelName = item.json.property_rss;\n      }\n\n      results.push({\n        json: {\n          videoId: videoId,\n          youtubeUrl: youtubeUrl,\n          title: title,\n          channelName: channelName\n        }\n      });\n    } catch (error) {\n      results.push({\n        json: {\n          errorMessage: error.message,\n          videoId: null,\n          youtubeUrl: null,\n          title: '오류',\n          channelName: '오류'\n        }\n      });\n    }\n  }\n\n  return results;\n\n"
      },
      "id": "extract-youtube-info",
      "name": "Extract YouTube Info",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        464,
        304
      ]
    },
    {
      "parameters": {
        "youtubeId": "={{ $json.json.videoId }}",
        "preferCapLang": "ko"
      },
      "id": "get-youtube-transcript",
      "name": "Get YouTube Transcript",
      "type": "n8n-nodes-bandi-youtube-transcript.youtubeTranscriptNode",
      "typeVersion": 1,
      "position": [
        688,
        304
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-001",
        "options": {
          "maxOutputTokens": 4000,
          "temperature": 0.6
        }
      },
      "id": "gemini-model",
      "name": "Gemini for Article",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        976,
        512
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "SO4eLSfcE2Z5kkss",
          "name": "hovoo Google Gemini Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "당신은 이미커피 대표 hovoo입니다.\n\n15년간 카페 4개 매장을 운영하며 F&B 브랜딩 전문가로 활동했습니다.\n동시에 AI 자동화 전문가로서 GPTers 커뮤니티에서 'AI 감성 브랜딩 시스템' 스터디를 운영하고 있습니다.\n\nYouTube 영상 자막을 바탕으로 당신의 경험과 통찰이 담긴 블로그 글을 작성하세요.\n\n[영상 정보]\n제목: {{ $('Extract YouTube Info').first().json.json.title }}\n채널: {{ $('Extract YouTube Info').first().json.json.channelName }}\nURL: {{ $('Extract YouTube Info').first().json.json.youtubeUrl }}\nVideo ID: {{ $('Extract YouTube Info').first().json.json.videoId }}\n\n[자막 전문]\n{{ $json.transcript }}\n\n[당신의 배경]\n- 이미커피 대표, 15년 F&B 운영 경험\n- 카페 4개 매장 + 베이커리 운영 중\n- AI 자동화 전문가 (n8n 워크플로우 5개 운영)\n- GPTers 스터디장, \"AI 감성 브랜딩 시스템\" 운영\n- 자영업자 대상 AI 교육 강의\n- 도메인: blog.imiwork.com\n\n[작성 스타일]\n1. 실무 경험 기반의 구체적 통찰\n2. 오프라인 비즈니스 × AI 융합 관점\n3. 자영업자/소상공인을 위한 실용적 조언\n4. 15년 카페 운영 경험에서 나오는 깊이\n5. 친근하지만 전문적인 어투\n6. 마크다운 형식, H1 제목 하나, H2/H3 소제목 구조화\n7. 최소 2500자 이상의 완전한 글\n\n[글 구조]\n- 도입: \"15년 카페를 운영하며 느낀...\" 식으로 경험 기반 시작\n- 본문: 영상 내용 + 본인 경험 융합\n- 실전 팁: F&B/AI 관점에서의 구체적 실행법\n- 결론: 독자의 비즈니스 성장을 위한 행동 유도\n\n영상 내용을 단순 요약하지 말고, 당신의 15년 경험과 AI 전문성으로 재해석해서 독자에게 가치 있는 통찰을 제공하는 완전한 블로그 글을 작성하세요.",
        "batching": {}
      },
      "id": "create-blog-article",
      "name": "Create Blog Article with hovoo Persona",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        896,
        304
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.0-flash-001",
        "options": {
          "maxOutputTokens": 4000,
          "temperature": 0.3
        }
      },
      "id": "gemini-seo",
      "name": "Gemini for SEO",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1328,
        528
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "SO4eLSfcE2Z5kkss",
          "name": "hovoo Google Gemini Api account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "# SEO 최적화 메타데이터 생성\n\n다음 블로그 글을 분석하여 SEO에 최적화된 메타데이터를 JSON 형식으로 생성해 주세요.\n\n**원본 블로그 글**: {{ $('Create Blog Article with hovoo Persona').item.json.text }}\n\n## 생성할 메타데이터:\n\n1. **title**: SEO 친화적 제목 (50-60자, 키워드 포함)\n2. **meta_description**: 메타 설명 (140-160자, 클릭 유도)\n3. **tags**: 관련 태그 배열 (5-8개, 검색량 높은 키워드)\n4. **slug**: URL 친화적 슬러그 (영문, 하이픈 사용)\n5. **excerpt**: 요약문 (200-250자, 글의 핵심 내용)\n6. **featured_image_alt**: 대표 이미지 alt 텍스트\n7. **keywords**: 타겟 키워드 배열 (롱테일 키워드 포함)\n8. **category**: 글 카테고리 (hovoo 블로그 맞춤)\n\n## 키워드 전략:\n- **Primary**: 카페 운영, AI 자동화, n8n 워크플로우\n- **Secondary**: 이미커피, hovoo, F&B 브랜딩\n- **Long-tail**: 구체적 기능/방법 관련 키워드\n\n## 고려사항:\n- hovoo의 전문성 영역 (카페 운영 + AI)\n- 타겟 독자: 자영업자, 소상공인, AI 활용 관심자\n- 검색 의도: 실무 적용 가능한 정보 추구\n\n**반드시 유효한 JSON 형식으로만 응답해 주세요.**",
        "batching": {}
      },
      "id": "seo-optimization",
      "name": "SEO Optimization",
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.7,
      "position": [
        1248,
        304
      ]
    },
    {
      "parameters": {
        "resource": "databasePage",
        "databaseId": {
          "__rl": true,
          "value": "251d0f53623d8158b023d994a1e58122",
          "mode": "id"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "제목",
              "type": "title"
            },
            {
              "key": "본문",
              "type": "rich_text"
            },
            {
              "key": "원본 영상",
              "type": "url",
              "urlValue": "={{ $('Extract YouTube Info').first().json.json.youtubeUrl }}"
            },
            {
              "key": "채널명",
              "type": "rich_text"
            },
            {
              "key": "URL 슬러그",
              "type": "rich_text"
            },
            {
              "key": "태그",
              "type": "multi_select",
              "multiSelectValue": "={{ $('Parse and Validate JSON').item.json.tags }}"
            },
            {
              "key": "상태",
              "type": "select",
              "selectValue": "Published"
            },
            {
              "key": "작성일",
              "type": "date",
              "date": "={{ $now }}"
            }
          ]
        },
        "options": {}
      },
      "id": "save-to-blog-db",
      "name": "Save to Blog DB",
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        1824,
        304
      ],
      "credentials": {
        "notionApi": {
          "id": "kCKFfrau35Gf4PvW",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $json.body.chatId || '7830356405' }}",
        "text": "🎉 *YouTube 블로그 자동화 완료!*\n\n📝 **제목**: {{ $('Parse and Validate JSON').item.json.title }}\n📊 **SEO 점수**: 최적화 완료\n🏷️ **태그**: {{ $('Parse and Validate JSON').item.json.tags.join(', ') }}\n📁 **카테고리**: {{ $('Parse and Validate JSON').item.json.category }}\n\n✅ **처리 완료 항목**:\n• YouTube 영상 정보 수집\n• 자막/전사 내용 추출\n• hovoo 페르소나 블로그 글 생성 ({{ $('Create Blog Article with hovoo Persona').item.json.text.length }}자)\n• SEO 메타데이터 최적화\n• Notion 블로그 DB 저장\n\n🔗 **생성된 슬러그**: `{{ $('Parse and Validate JSON').item.json.slug }}`\n\n💡 **다음 단계**: Ghost 블로그 자동 발행을 위해 별도 워크플로우를 실행해 주세요.\n\n---\n*이미커피 AI 자동화 시스템 | hovoo*",
        "additionalFields": {
          "parse_mode": "Markdown"
        }
      },
      "id": "send-success-message",
      "name": "Send Success Message",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        2016,
        304
      ],
      "webhookId": "e13eaeca-b192-45fb-ad83-75cba346d736",
      "credentials": {
        "telegramApi": {
          "id": "hIo5i77YKdu9Rs8g",
          "name": "youtube imi Telegram account"
        }
      }
    },
    {
      "parameters": {
        "respondWith": "json",
        "responseBody": "{\n  \"success\": true,\n  \"message\": \"YouTube 블로그 자동화가 성공적으로 완료되었습니다.\",\n  \"data\": {\n    \"title\": \"{{ $('Parse and Validate JSON').item.json.title }}\",\n    \"slug\": \"{{ $('Parse and Validate JSON').item.json.slug }}\",\n    \"category\": \"{{ $('Parse and Validate JSON').item.json.category }}\",\n    \"tags\": {{ JSON.stringify($('Parse and Validate JSON').item.json.tags) }},\n    \"content_length\": {{ $('Create Blog Article with hovoo Persona').item.json.text.length }},\n    \"notion_page_id\": \"{{ $('Save to Blog DB').item.json.id }}\",\n    \"processed_at\": \"{{ $now.toISO() }}\",\n    \"processing_time_seconds\": \"{{ Math.round(($now - new Date($('Webhook Trigger').item.json.timestamp || Date.now())) / 1000) }}\"\n  }\n}",
        "options": {}
      },
      "id": "webhook-response",
      "name": "Webhook Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.5,
      "position": [
        2208,
        304
      ]
    },
    {
      "parameters": {
        "jsCode": "  // Enhanced JSON 파싱 및 검증 with hovoo persona\n  const rawText = $input.first().json.text;\n  let jsonText = rawText;\n\n  // JSON 추출\n  if (rawText.includes('```json')) {\n    const start = rawText.indexOf('```json') + 7;\n    const end = rawText.lastIndexOf('```');\n    jsonText = rawText.substring(start, end).trim();\n  } else if (rawText.includes('{')) {\n    // 첫 번째 {부터 마지막 }까지 추출\n    const start = rawText.indexOf('{');\n    const end = rawText.lastIndexOf('}');\n    if (start !== -1 && end !== -1 && end > start) {\n      jsonText = rawText.substring(start, end + 1);\n    }\n  }\n\n  try {\n    const data = JSON.parse(jsonText);\n\n    // 필수 필드 검증 및 기본값 설정\n    const result = {\n      title: data.title || 'hovoo의 실무 경험 공유',\n      meta_description: data.meta_description || '이미커피 대표 hovoo의 15년 F&B 운영 경험과 AI 자동화 노하우',\n      tags: Array.isArray(data.tags) ? data.tags : ['이미커피', 'hovoo', 'AI자동화', '카페운영'],\n      slug: data.slug || 'hovoo-blog-' + Date.now(),\n      excerpt: data.excerpt || data.meta_description || '실무 경험 기반의 가치 있는 통찰',\n      featured_image_alt: data.featured_image_alt || 'hovoo 이미커피 AI 자동화 시스템',\n      keywords: Array.isArray(data.keywords) ? data.keywords : ['카페 운영', 'AI 자동화', 'hovoo', '이미커피'],\n      category: data.category || 'AI 실무 활용'\n    };\n\n    // 슬러그 정리 (한글 제거, 특수문자 정리)\n    result.slug = result.slug\n      .toLowerCase()\n      .replace(/[^a-z0-9가-힣\\s-]/g, '')\n      .replace(/[가-힣]/g, '')\n      .replace(/\\s+/g, '-')\n      .replace(/-+/g, '-')\n      .replace(/^-|-$/g, '')\n      .substring(0, 50);\n\n    // 빈 슬러그 방지\n    if (!result.slug || result.slug === '') {\n      result.slug = 'hovoo-blog-' + Date.now();\n    }\n\n    // hovoo 브랜드 태그 강제 포함\n    if (!result.tags.includes('이미커피')) {\n      result.tags.unshift('이미커피');\n    }\n    if (!result.tags.includes('hovoo')) {\n      result.tags.unshift('hovoo');\n    }\n\n    return result;\n\n  } catch (error) {\n    // 파싱 실패 시 안전한 기본값\n    return {\n      title: 'hovoo의 실무 경험 - AI 자동화 블로그',\n      meta_description: '이미커피 대표 hovoo의 15년 F&B 운영 경험과 AI 자동화 실무 노하우를 공유합니다.',\n      tags: ['이미커피', 'hovoo', 'AI자동화', '카페운영', 'F&B브랜딩'],\n      slug: 'hovoo-blog-' + Date.now(),\n      excerpt: 'AI와 오프라인 비즈니스를 결합한 실무 경험을 바탕으로 한 가치 있는 통찰을 제공합니다.',\n      featured_image_alt: 'hovoo 이미커피 AI 자동화 시스템',\n      keywords: ['카페 운영 노하우', 'AI 자동화', 'hovoo 경험', '이미커피 시스템'],\n      category: 'AI 실무 활용',\n      success: false,\n      error: error.message,\n      raw_output: rawText\n    };\n  }\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1616,
        304
      ],
      "id": "130ab1c5-960e-4aa3-83db-35beb665e99d",
      "name": "Parse and Validate JSON"
    }
  ],
  "connections": {
    "Webhook Trigger": {
      "main": [
        [
          {
            "node": "Get Video Info from Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Video Info from Notion": {
      "main": [
        [
          {
            "node": "Extract YouTube Info",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract YouTube Info": {
      "main": [
        [
          {
            "node": "Get YouTube Transcript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get YouTube Transcript": {
      "main": [
        [
          {
            "node": "Create Blog Article with hovoo Persona",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini for Article": {
      "ai_languageModel": [
        [
          {
            "node": "Create Blog Article with hovoo Persona",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ],
      "main": [
        []
      ]
    },
    "Create Blog Article with hovoo Persona": {
      "main": [
        [
          {
            "node": "SEO Optimization",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini for SEO": {
      "ai_languageModel": [
        [
          {
            "node": "SEO Optimization",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ],
      "main": [
        []
      ]
    },
    "SEO Optimization": {
      "main": [
        [
          {
            "node": "Parse and Validate JSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Save to Blog DB": {
      "main": [
        [
          {
            "node": "Send Success Message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send Success Message": {
      "main": [
        [
          {
            "node": "Webhook Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Parse and Validate JSON": {
      "main": [
        [
          {
            "node": "Save to Blog DB",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "503b3d8b44115e5921e2e4e1edcde177dde00c303a77361802e2da13d7103e31"
  }
}