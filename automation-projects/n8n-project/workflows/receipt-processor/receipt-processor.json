{
  "name": "ì˜ìˆ˜ì¦ ì²˜ë¦¬ê¸° - 5ê°œ ì‚¬ì—…ì¥",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "id": "5bd8b5ee-6fce-4d6d-b3b8-c6d6f98a2b3c",
      "name": "ì‚¬ë¬´ì‹¤ - 10ë¶„ë§ˆë‹¤ ì²´í¬",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        140,
        300
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "id": "7a2c4f11-8e3d-4b2e-9f1a-d5e7b9c3a4f2",
      "name": "ë™êµë™ - 10ë¶„ë§ˆë‹¤ ì²´í¬",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        140,
        500
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "id": "3e9f1b2c-5d7a-4c8e-af3b-1e6d9c2f4a7b",
      "name": "ì¸ì‚¬ë™ - 10ë¶„ë§ˆë‹¤ ì²´í¬",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        140,
        700
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "id": "8f4a2c7e-1b9d-3e5f-6a8c-4f7e2d1b5c9a",
      "name": "êµ¬ë¡œ - 10ë¶„ë§ˆë‹¤ ì²´í¬",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        140,
        900
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "minutes",
              "minutesInterval": 10
            }
          ]
        }
      },
      "id": "2d6f9a1e-4c8b-7e3f-5a9d-8b4e1f7c2a6d",
      "name": "ì—°ë‚¨ë™ - 10ë¶„ë§ˆë‹¤ ì²´í¬",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [
        140,
        1100
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "file",
        "operation": "list",
        "driveId": {
          "__rl": true,
          "value": "1aB2cD3eF4gH5iJ6kL7mN8oP9qR0sT1u",
          "mode": "list",
          "cachedResultName": "ì‚¬ë¬´ì‹¤ ì˜ìˆ˜ì¦"
        },
        "folderId": {
          "__rl": true,
          "value": "1xY2zA3bC4dE5fG6hI7jK8lM9nO0pQ1r",
          "mode": "list",
          "cachedResultName": "ì²˜ë¦¬ëŒ€ê¸°"
        },
        "filters": {
          "name": "*.jpg,*.jpeg,*.png,*.pdf"
        }
      },
      "id": "4b7e2a9f-6d1c-3e8a-5f9b-2c4e7a1d6f3b",
      "name": "ì‚¬ë¬´ì‹¤ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        360,
        300
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "file",
        "operation": "list",
        "driveId": {
          "__rl": true,
          "value": "2bC3dE4fG5hI6jK7lM8nO9pQ0rS1tU2v",
          "mode": "list",
          "cachedResultName": "ë™êµë™ ì˜ìˆ˜ì¦"
        },
        "folderId": {
          "__rl": true,
          "value": "2yZ3aB4cD5eF6gH7iJ8kL9mN0oP1qR2s",
          "mode": "list",
          "cachedResultName": "ì²˜ë¦¬ëŒ€ê¸°"
        },
        "filters": {
          "name": "*.jpg,*.jpeg,*.png,*.pdf"
        }
      },
      "id": "9e2f5a1b-8c4d-6f3a-7e9b-4a2c5f8e1d7b",
      "name": "ë™êµë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        360,
        500
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "file",
        "operation": "list",
        "driveId": {
          "__rl": true,
          "value": "3cD4eF5gH6iJ7kL8mN9oP0qR1sT2uV3w",
          "mode": "list",
          "cachedResultName": "ì¸ì‚¬ë™ ì˜ìˆ˜ì¦"
        },
        "folderId": {
          "__rl": true,
          "value": "3zA4bC5dE6fG7hI8jK9lM0nO1pQ2rS3t",
          "mode": "list",
          "cachedResultName": "ì²˜ë¦¬ëŒ€ê¸°"
        },
        "filters": {
          "name": "*.jpg,*.jpeg,*.png,*.pdf"
        }
      },
      "id": "1f8a4c2e-9b5d-7f2a-6e8c-3a5f9b2e4d8a",
      "name": "ì¸ì‚¬ë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        360,
        700
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "file",
        "operation": "list",
        "driveId": {
          "__rl": true,
          "value": "4dE5fG6hI7jK8lM9nO0pQ1rS2tU3vW4x",
          "mode": "list",
          "cachedResultName": "êµ¬ë¡œ ì˜ìˆ˜ì¦"
        },
        "folderId": {
          "__rl": true,
          "value": "4aB5cD6eF7gH8iJ9kL0mN1oP2qR3sT4u",
          "mode": "list",
          "cachedResultName": "ì²˜ë¦¬ëŒ€ê¸°"
        },
        "filters": {
          "name": "*.jpg,*.jpeg,*.png,*.pdf"
        }
      },
      "id": "6c9f2b4e-1a7d-5f8a-3e6c-8b1f4a7e2d9c",
      "name": "êµ¬ë¡œ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        360,
        900
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "file",
        "operation": "list",
        "driveId": {
          "__rl": true,
          "value": "5eF6gH7iJ8kL9mN0oP1qR2sT3uV4wX5y",
          "mode": "list",
          "cachedResultName": "ì—°ë‚¨ë™ ì˜ìˆ˜ì¦"
        },
        "folderId": {
          "__rl": true,
          "value": "5bC6dE7fG8hI9jK0lM1nO2pQ3rS4tU5v",
          "mode": "list",
          "cachedResultName": "ì²˜ë¦¬ëŒ€ê¸°"
        },
        "filters": {
          "name": "*.jpg,*.jpeg,*.png,*.pdf"
        }
      },
      "id": "8a3f6c1e-4b9d-2f7a-5e8c-9a2f6c4e7b1a",
      "name": "ì—°ë‚¨ë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        360,
        1100
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.files ? $json.files.length : 0 }}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "7e4a1f9b-2c6d-8f3a-4e7b-1a5f9c2e6d8a",
      "name": "ì‚¬ë¬´ì‹¤ íŒŒì¼ ìˆë‚˜?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        580,
        300
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.files ? $json.files.length : 0 }}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "3b8e5a2f-7d1c-4f6a-9e3b-6a4f8e1c5d7b",
      "name": "ë™êµë™ íŒŒì¼ ìˆë‚˜?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        580,
        500
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.files ? $json.files.length : 0 }}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "9f2c6a4e-8b5d-1f7a-3e9c-5a8f2c6e4d9a",
      "name": "ì¸ì‚¬ë™ íŒŒì¼ ìˆë‚˜?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        580,
        700
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.files ? $json.files.length : 0 }}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "2d7f3a6c-4e9b-8f2a-6d8c-1a7f3c6e9b2d",
      "name": "êµ¬ë¡œ íŒŒì¼ ìˆë‚˜?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        580,
        900
      ]
    },
    {
      "parameters": {
        "conditions": {
          "number": [
            {
              "value1": "={{ $json.files ? $json.files.length : 0 }}",
              "operation": "larger",
              "value2": 0
            }
          ]
        }
      },
      "id": "5c8a2f6e-1d4b-7f9a-2c5e-8a1f5c9e2d6a",
      "name": "ì—°ë‚¨ë™ íŒŒì¼ ìˆë‚˜?",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        580,
        1100
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì‚¬ë¬´ì‹¤ ì‚¬ì—…ì¥ í‘œì‹œ ì¶”ê°€\nfor (const item of $input.all()) {\n  item.json.location = 'ì‚¬ë¬´ì‹¤';\n  item.json.location_code = 'office';\n}\n\nreturn $input.all();"
      },
      "id": "4f9a2c6e-8b5d-1f7a-4f9c-2a6f9c3e8b5d",
      "name": "ì‚¬ë¬´ì‹¤ ìœ„ì¹˜ íƒœê·¸",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        250
      ]
    },
    {
      "parameters": {
        "jsCode": "// ë™êµë™ ì‚¬ì—…ì¥ í‘œì‹œ ì¶”ê°€\nfor (const item of $input.all()) {\n  item.json.location = 'ë™êµë™';\n  item.json.location_code = 'donggyo';\n}\n\nreturn $input.all();"
      },
      "id": "7c2e5a8f-4b9d-6f3a-7c2f-5a8c2f6e9b4d",
      "name": "ë™êµë™ ìœ„ì¹˜ íƒœê·¸",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        450
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì¸ì‚¬ë™ ì‚¬ì—…ì¥ í‘œì‹œ ì¶”ê°€\nfor (const item of $input.all()) {\n  item.json.location = 'ì¸ì‚¬ë™';\n  item.json.location_code = 'insadong';\n}\n\nreturn $input.all();"
      },
      "id": "1a5f8c2e-9b4d-3f7a-1a5c-8f2a5c9e4b7d",
      "name": "ì¸ì‚¬ë™ ìœ„ì¹˜ íƒœê·¸",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        650
      ]
    },
    {
      "parameters": {
        "jsCode": "// êµ¬ë¡œ ì‚¬ì—…ì¥ í‘œì‹œ ì¶”ê°€\nfor (const item of $input.all()) {\n  item.json.location = 'êµ¬ë¡œ';\n  item.json.location_code = 'guro';\n}\n\nreturn $input.all();"
      },
      "id": "6d9c2f5a-3e8b-1f4a-6d9f-2c5f9c8e3b1d",
      "name": "êµ¬ë¡œ ìœ„ì¹˜ íƒœê·¸",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        850
      ]
    },
    {
      "parameters": {
        "jsCode": "// ì—°ë‚¨ë™ ì‚¬ì—…ì¥ í‘œì‹œ ì¶”ê°€\nfor (const item of $input.all()) {\n  item.json.location = 'ì—°ë‚¨ë™';\n  item.json.location_code = 'yeonnam';\n}\n\nreturn $input.all();"
      },
      "id": "8b4e7a1f-2c5d-9f6a-8b4a-7e1c5f2a6d9c",
      "name": "ì—°ë‚¨ë™ ìœ„ì¹˜ íƒœê·¸",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        1050
      ]
    },
    {
      "parameters": {
        "mode": "combine",
        "combinationMode": "mergeByIndex",
        "options": {}
      },
      "id": "3c7f1a5e-9b2d-4f8a-3c7a-1f5c7a9e2d4f",
      "name": "ëª¨ë“  ë§¤ì¥ í†µí•©",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 2.1,
      "position": [
        1020,
        650
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "file",
        "operation": "download",
        "fileId": "={{ $json.id }}",
        "options": {
          "googleFileConversion": {
            "conversion": {
              "docsToFormat": "txt"
            }
          }
        }
      },
      "id": "9e3a6c2f-7b1d-5f4a-9e3c-6a2c9e4f7b5d",
      "name": "ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        1240,
        650
      ]
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.1
        },
        "messages": {
          "values": [
            {
              "role": "user",
              "content": "=ì´ ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ë¥¼ ë¶„ì„í•´ì„œ ë‹¤ìŒ ì •ë³´ë¥¼ JSON í˜•íƒœë¡œ ì¶”ì¶œí•´ì£¼ì„¸ìš”:\n\n{\n  \"date\": \"YYYY-MM-DD\",\n  \"store_name\": \"ìƒí˜¸ëª…\",\n  \"business_number\": \"ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸\",\n  \"total_amount\": ì´ê¸ˆì•¡ìˆ«ìë§Œ,\n  \"tax_amount\": ì„¸ê¸ˆê¸ˆì•¡ìˆ«ìë§Œ,\n  \"items\": [\n    {\n      \"name\": \"í’ˆëª©ëª…\",\n      \"quantity\": ìˆ˜ëŸ‰ìˆ«ìë§Œ,\n      \"unit_price\": ë‹¨ê°€ìˆ«ìë§Œ,\n      \"amount\": ê¸ˆì•¡ìˆ«ìë§Œ\n    }\n  ],\n  \"payment_method\": \"ê²°ì œë°©ë²•\",\n  \"category_suggestion\": \"ë‹¤ìŒ 9ê°œ ì¤‘ í•˜ë‚˜: ì‹ì¬ë£Œë¹„, ë¶€ì¬ë£Œë¹„, í¬ì¥ì¬ë¹„, ìš´ë°˜ë¹„, ìˆ˜ë„ê´‘ì—´ë¹„, ì†Œëª¨í’ˆë¹„, ìˆ˜ì„ ë¹„, ê´‘ê³ ì„ ì „ë¹„, ê¸°íƒ€\"\n}\n\nì˜ìˆ˜ì¦ì´ ë¶ˆë¶„ëª…í•˜ê±°ë‚˜ ì½ê¸° ì–´ë ¤ìš´ ë¶€ë¶„ì€ \"í™•ì¸ë¶ˆê°€\"ë¡œ í‘œì‹œí•´ì£¼ì„¸ìš”."
            }
          ]
        },
        "inputBinaryField": "data",
        "options": {
          "useCustomFields": true,
          "customFields": {
            "values": [
              {
                "name": "detail",
                "value": "low"
              }
            ]
          }
        }
      },
      "id": "2f6a9c4e-8b3d-1f5a-2f6c-9a4c2f8e5b1d",
      "name": "GPT-4oë¡œ OCR ì²˜ë¦¬",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.3,
      "position": [
        1460,
        650
      ]
    },
    {
      "parameters": {
        "jsCode": "// GPT ì‘ë‹µì—ì„œ JSON ì¶”ì¶œ ë° íŒŒì‹±\nconst items = [];\n\nfor (const item of $input.all()) {\n  try {\n    let gptResponse = item.json.response || item.json.output || '';\n    \n    // JSON ë¶€ë¶„ë§Œ ì¶”ì¶œ (```json ë¸”ë¡ì´ë‚˜ ì¼ë°˜ JSON)\n    let jsonMatch = gptResponse.match(/```json\\s*([\\s\\S]*?)\\s*```/) || \n                   gptResponse.match(/\\{[\\s\\S]*\\}/);\n    \n    if (jsonMatch) {\n      const jsonStr = jsonMatch[1] || jsonMatch[0];\n      const parsedData = JSON.parse(jsonStr);\n      \n      // ì›ë³¸ ë°ì´í„°ì™€ íŒŒì‹±ëœ ë°ì´í„° ê²°í•©\n      items.push({\n        ...item.json,\n        extracted_data: parsedData,\n        processing_status: 'success',\n        processed_at: new Date().toISOString(),\n        file_name: item.json.name || 'ì•Œìˆ˜ì—†ìŒ'\n      });\n    } else {\n      throw new Error('JSON í˜•ì‹ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');\n    }\n  } catch (error) {\n    items.push({\n      ...item.json,\n      extracted_data: null,\n      processing_status: 'error',\n      error_message: error.message,\n      processed_at: new Date().toISOString(),\n      file_name: item.json.name || 'ì•Œìˆ˜ì—†ìŒ'\n    });\n  }\n}\n\nreturn items.map(item => ({ json: item }));"
      },
      "id": "5a8c3f6e-1b9d-4f2a-5a8f-3c6a5f9e2b4d",
      "name": "OCR ê²°ê³¼ íŒŒì‹±",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1680,
        650
      ]
    },
    {
      "parameters": {
        "conditions": {
          "string": [
            {
              "value1": "={{ $json.processing_status }}",
              "operation": "equal",
              "value2": "success"
            }
          ]
        }
      },
      "id": "7b2f5a9c-4e8d-6f1a-7b2a-5f9b7e4c8d1f",
      "name": "ì²˜ë¦¬ ì„±ê³µí•œ ê²ƒë§Œ",
      "type": "n8n-nodes-base.if",
      "typeVersion": 1,
      "position": [
        1900,
        650
      ]
    },
    {
      "parameters": {
        "model": "gpt-4o-mini",
        "options": {
          "temperature": 0.1,
          "maxTokens": 200
        },
        "messages": {
          "values": [
            {
              "role": "system",
              "content": "ë‹¹ì‹ ì€ ì¹´í˜ ìš´ì˜ì˜ íšŒê³„ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì˜ìˆ˜ì¦ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì •í™•í•œ ê³„ì •ê³¼ëª©ì„ ë¶„ë¥˜í•´ì£¼ì„¸ìš”."
            },
            {
              "role": "user",
              "content": "=ë‹¤ìŒ ì˜ìˆ˜ì¦ ì •ë³´ë¥¼ ë¶„ì„í•´ì„œ ê°€ì¥ ì ì ˆí•œ ê³„ì •ê³¼ëª© 1ê°œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.\n\nì˜ìˆ˜ì¦ ì •ë³´:\n- ìƒí˜¸ëª…: {{ $json.extracted_data.store_name }}\n- ì´ê¸ˆì•¡: {{ $json.extracted_data.total_amount }}ì›\n- êµ¬ë§¤í’ˆëª©: {{ $json.extracted_data.items ? $json.extracted_data.items.map(item => item.name).join(', ') : 'í™•ì¸ë¶ˆê°€' }}\n- ì‚¬ì—…ì¥: {{ $json.location }}\n\nì„ íƒê°€ëŠ¥í•œ ê³„ì •ê³¼ëª© (9ê°œ):\n1. ì‹ì¬ë£Œë¹„ - ì»¤í”¼ì›ë‘, ìš°ìœ , ì‹œëŸ½, ë² ì´ì»¤ë¦¬ ì¬ë£Œ ë“±\n2. ë¶€ì¬ë£Œë¹„ - ì„¤íƒ•, ë¹¨ëŒ€, ëƒ…í‚¨, ì»µí™€ë” ë“± ì†Œëª¨ì„± ë¶€ìì¬\n3. í¬ì¥ì¬ë¹„ - ì¼íšŒìš© ì»µ, ëšœê»‘, í¬ì¥ì§€, ì‡¼í•‘ë°± ë“±\n4. ìš´ë°˜ë¹„ - ë°°ì†¡ë¹„, íƒë°°ë¹„, ìš´ì†¡ë£Œ ë“±\n5. ìˆ˜ë„ê´‘ì—´ë¹„ - ì „ê¸°ë£Œ, ê°€ìŠ¤ë£Œ, ìƒí•˜ìˆ˜ë„ë£Œ ë“±\n6. ì†Œëª¨í’ˆë¹„ - ì²­ì†Œìš©í’ˆ, ì‚¬ë¬´ìš©í’ˆ, ë§¤ì¥ ê´€ë¦¬ìš©í’ˆ ë“±\n7. ìˆ˜ì„ ë¹„ - ì¥ë¹„ìˆ˜ë¦¬, ì¸í…Œë¦¬ì–´ ë³´ìˆ˜, ê¸°ê³„ì ê²€ ë“±\n8. ê´‘ê³ ì„ ì „ë¹„ - ë§ˆì¼€íŒ…, ê´‘ê³ , í™ë³´ë¬¼ ì œì‘ ë“±\n9. ê¸°íƒ€ - ìœ„ 8ê°œì— í•´ë‹¹í•˜ì§€ ì•ŠëŠ” ëª¨ë“  ë¹„ìš©\n\në‹µë³€ í˜•ì‹: ìˆ«ìë§Œ (ì˜ˆ: 1, 2, 3...)"
            }
          ]
        }
      },
      "id": "4c9a2f6e-7b1d-3f8a-4c9f-2a6c4f8e7b3d",
      "name": "AI ê³„ì •ê³¼ëª© ë¶„ë¥˜",
      "type": "@n8n/n8n-nodes-langchain.openAi",
      "typeVersion": 1.3,
      "position": [
        2120,
        600
      ]
    },
    {
      "parameters": {
        "jsCode": "// ê³„ì •ê³¼ëª© ë§¤í•‘ ë° ìµœì¢… ë°ì´í„° ì •ë¦¬\nconst accountMapping = {\n  '1': 'ì‹ì¬ë£Œë¹„',\n  '2': 'ë¶€ì¬ë£Œë¹„', \n  '3': 'í¬ì¥ì¬ë¹„',\n  '4': 'ìš´ë°˜ë¹„',\n  '5': 'ìˆ˜ë„ê´‘ì—´ë¹„',\n  '6': 'ì†Œëª¨í’ˆë¹„',\n  '7': 'ìˆ˜ì„ ë¹„',\n  '8': 'ê´‘ê³ ì„ ì „ë¹„',\n  '9': 'ê¸°íƒ€'\n};\n\nconst items = [];\n\nfor (const item of $input.all()) {\n  const aiCategory = (item.json.response || '').trim();\n  const categoryName = accountMapping[aiCategory] || 'ê¸°íƒ€';\n  \n  // ìµœì¢… ì²˜ë¦¬ ë°ì´í„° êµ¬ì¡°í™”\n  const processedData = {\n    // ê¸°ë³¸ ì •ë³´\n    file_id: item.json.id,\n    file_name: item.json.name,\n    location: item.json.location,\n    location_code: item.json.location_code,\n    \n    // ì¶”ì¶œëœ ì˜ìˆ˜ì¦ ì •ë³´\n    receipt_date: item.json.extracted_data?.date || 'í™•ì¸ë¶ˆê°€',\n    store_name: item.json.extracted_data?.store_name || 'í™•ì¸ë¶ˆê°€',\n    business_number: item.json.extracted_data?.business_number || 'í™•ì¸ë¶ˆê°€',\n    total_amount: item.json.extracted_data?.total_amount || 0,\n    tax_amount: item.json.extracted_data?.tax_amount || 0,\n    payment_method: item.json.extracted_data?.payment_method || 'í™•ì¸ë¶ˆê°€',\n    \n    // AI ë¶„ë¥˜ ê²°ê³¼\n    account_category_code: aiCategory,\n    account_category_name: categoryName,\n    \n    // í’ˆëª© ì •ë³´ (ë¬¸ìì—´ë¡œ ë³€í™˜)\n    items_detail: item.json.extracted_data?.items ? \n      item.json.extracted_data.items.map(i => `${i.name}(${i.quantity}ê°œÃ—${i.unit_price}ì›)`).join('; ') : 'í™•ì¸ë¶ˆê°€',\n    \n    // ì²˜ë¦¬ ë©”íƒ€ë°ì´í„°\n    processed_at: new Date().toISOString(),\n    sheet_row_data: [\n      new Date().toLocaleDateString('ko-KR'), // A: ì²˜ë¦¬ì¼\n      item.json.location, // B: ì‚¬ì—…ì¥\n      item.json.extracted_data?.date || 'í™•ì¸ë¶ˆê°€', // C: ì˜ìˆ˜ì¦ì¼ì\n      item.json.extracted_data?.store_name || 'í™•ì¸ë¶ˆê°€', // D: ìƒí˜¸ëª…\n      categoryName, // E: ê³„ì •ê³¼ëª©\n      item.json.extracted_data?.total_amount || 0, // F: ê¸ˆì•¡\n      item.json.extracted_data?.tax_amount || 0, // G: ì„¸ì•¡\n      item.json.extracted_data?.payment_method || 'í™•ì¸ë¶ˆê°€', // H: ê²°ì œë°©ë²•\n      item.json.name, // I: íŒŒì¼ëª…\n      item.json.extracted_data?.business_number || 'í™•ì¸ë¶ˆê°€' // J: ì‚¬ì—…ìë²ˆí˜¸\n    ]\n  };\n  \n  items.push(processedData);\n}\n\nreturn items.map(item => ({ json: item }));"
      },
      "id": "8d5f2a9c-3b7e-6f1a-8d5a-2f9d8b3c7e6a",
      "name": "ìµœì¢… ë°ì´í„° ì •ë¦¬",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2340,
        600
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1mN2oP3qR4sT5uV6wX7yZ8aB9cD0eF1gH",
          "mode": "list",
          "cachedResultName": "ì˜ìˆ˜ì¦ ê´€ë¦¬ëŒ€ì¥"
        },
        "sheetName": "=Sheet1",
        "columnToMatchOn": "I",
        "valueToMatchOn": "={{ $json.file_name }}",
        "options": {
          "cellFormat": "USER_ENTERED",
          "useAppend": true
        },
        "columnsUi": {
          "values": [
            {
              "column": "A",
              "value": "={{ $json.sheet_row_data[0] }}"
            },
            {
              "column": "B", 
              "value": "={{ $json.sheet_row_data[1] }}"
            },
            {
              "column": "C",
              "value": "={{ $json.sheet_row_data[2] }}"
            },
            {
              "column": "D",
              "value": "={{ $json.sheet_row_data[3] }}"
            },
            {
              "column": "E",
              "value": "={{ $json.sheet_row_data[4] }}"
            },
            {
              "column": "F",
              "value": "={{ $json.sheet_row_data[5] }}"
            },
            {
              "column": "G",
              "value": "={{ $json.sheet_row_data[6] }}"
            },
            {
              "column": "H",
              "value": "={{ $json.sheet_row_data[7] }}"
            },
            {
              "column": "I",
              "value": "={{ $json.sheet_row_data[8] }}"
            },
            {
              "column": "J",
              "value": "={{ $json.sheet_row_data[9] }}"
            }
          ]
        }
      },
      "id": "1a6c9f2e-4d7b-8f3a-1a6f-9c2a1d7e4b8c",
      "name": "êµ¬ê¸€ ì‹œíŠ¸ ê¸°ë¡",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.4,
      "position": [
        2560,
        600
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "file",
        "operation": "update",
        "fileId": "={{ $json.file_id }}",
        "updateFields": {
          "name": "={{ $json.processed_at.split('T')[0] }}_{{ $json.location_code }}_{{ $json.account_category_name }}_{{ $json.total_amount }}ì›_{{ $json.file_name }}"
        }
      },
      "id": "6f3a8c2e-9b1d-5f4a-6f3c-8a2c6f9e1d5b",
      "name": "íŒŒì¼ëª… ë³€ê²½",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        2780,
        600
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "resource": "file", 
        "operation": "move",
        "fileId": "={{ $json.file_id }}",
        "driveId": {
          "__rl": true,
          "value": "={{ $json.location_code === 'office' ? '1aB2cD3eF4gH5iJ6kL7mN8oP9qR0sT1u' : \n              $json.location_code === 'donggyo' ? '2bC3dE4fG5hI6jK7lM8nO9pQ0rS1tU2v' :\n              $json.location_code === 'insadong' ? '3cD4eF5gH6iJ7kL8mN9oP0qR1sT2uV3w' :\n              $json.location_code === 'guro' ? '4dE5fG6hI7jK8lM9nO0pQ1rS2tU3vW4x' :\n              '5eF6gH7iJ8kL9mN0oP1qR2sT3uV4wX5y' }}",
          "mode": "list"
        },
        "folderId": {
          "__rl": true,
          "value": "={{ $json.location_code === 'office' ? '1pQ2rS3tU4vW5xY6zA7bC8dE9fG0hI1j' : \n              $json.location_code === 'donggyo' ? '2qR3sT4uV5wX6yZ7aB8cD9eF0gH1iJ2k' :\n              $json.location_code === 'insadong' ? '3rS4tU5vW6xY7zA8bC9dE0fG1hI2jK3l' :\n              $json.location_code === 'guro' ? '4sT5uV6wX7yZ8aB9cD0eF1gH2iJ3kL4m' :\n              '5tU6vW7xY8zA9bC0dE1fG2hI3jK4lM5n' }}",
          "mode": "list"
        }
      },
      "id": "3c8f5a2e-7b4d-9f1a-3c8a-5f2c8f7e4b9d",
      "name": "ì™„ë£Œí´ë”ë¡œ ì´ë™",
      "type": "n8n-nodes-base.googleDrive",
      "typeVersion": 3,
      "position": [
        3000,
        600
      ]
    },
    {
      "parameters": {
        "chatId": "-1001234567890",
        "text": "=ğŸ§¾ ì˜ìˆ˜ì¦ ì²˜ë¦¬ ì™„ë£Œ\n\nğŸ“ **{{ $json.location }}**\nğŸ“… ì˜ìˆ˜ì¦ì¼ì: {{ $json.receipt_date }}\nğŸª ìƒí˜¸: {{ $json.store_name }}\nğŸ’° ê¸ˆì•¡: {{ $json.total_amount.toLocaleString() }}ì›\nğŸ“Š ê³„ì •ê³¼ëª©: {{ $json.account_category_name }}\nğŸ“ íŒŒì¼: {{ $json.file_name }}\n\nâ° {{ $json.processed_at.split('T')[0] }} {{ $json.processed_at.split('T')[1].split('.')[0] }} ì²˜ë¦¬ì™„ë£Œ",
        "additionalFields": {
          "disable_notification": true
        }
      },
      "id": "9a4c2f7e-6b8d-1f5a-9a4f-2c7a9e6b8d1c",
      "name": "í…”ë ˆê·¸ë¨ ì•Œë¦¼",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3220,
        600
      ]
    },
    {
      "parameters": {
        "chatId": "-1001234567890",
        "text": "=âš ï¸ ì˜ìˆ˜ì¦ ì²˜ë¦¬ ì‹¤íŒ¨\n\nğŸ“ **{{ $json.location }}**\nğŸ“ íŒŒì¼: {{ $json.file_name || 'íŒŒì¼ëª… ì•Œìˆ˜ì—†ìŒ' }}\nâŒ ì˜¤ë¥˜: {{ $json.error_message || 'ì•Œìˆ˜ì—†ëŠ” ì˜¤ë¥˜' }}\n\nğŸ”§ ìˆ˜ë™ í™•ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.",
        "additionalFields": {
          "disable_notification": false
        }
      },
      "id": "2e7f4a9c-8b3d-5f6a-2e7a-4f9e2b8c5d6f",
      "name": "ì‹¤íŒ¨ ì•Œë¦¼",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        3220,
        750
      ]
    }
  ],
  "connections": {
    "ì‚¬ë¬´ì‹¤ - 10ë¶„ë§ˆë‹¤ ì²´í¬": {
      "main": [
        [
          {
            "node": "ì‚¬ë¬´ì‹¤ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë™êµë™ - 10ë¶„ë§ˆë‹¤ ì²´í¬": {
      "main": [
        [
          {
            "node": "ë™êµë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¸ì‚¬ë™ - 10ë¶„ë§ˆë‹¤ ì²´í¬": {
      "main": [
        [
          {
            "node": "ì¸ì‚¬ë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "êµ¬ë¡œ - 10ë¶„ë§ˆë‹¤ ì²´í¬": {
      "main": [
        [
          {
            "node": "êµ¬ë¡œ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì—°ë‚¨ë™ - 10ë¶„ë§ˆë‹¤ ì²´í¬": {
      "main": [
        [
          {
            "node": "ì—°ë‚¨ë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì‚¬ë¬´ì‹¤ ì˜ìˆ˜ì¦ ê²€ìƒ‰": {
      "main": [
        [
          {
            "node": "ì‚¬ë¬´ì‹¤ íŒŒì¼ ìˆë‚˜?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë™êµë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰": {
      "main": [
        [
          {
            "node": "ë™êµë™ íŒŒì¼ ìˆë‚˜?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¸ì‚¬ë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰": {
      "main": [
        [
          {
            "node": "ì¸ì‚¬ë™ íŒŒì¼ ìˆë‚˜?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "êµ¬ë¡œ ì˜ìˆ˜ì¦ ê²€ìƒ‰": {
      "main": [
        [
          {
            "node": "êµ¬ë¡œ íŒŒì¼ ìˆë‚˜?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì—°ë‚¨ë™ ì˜ìˆ˜ì¦ ê²€ìƒ‰": {
      "main": [
        [
          {
            "node": "ì—°ë‚¨ë™ íŒŒì¼ ìˆë‚˜?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì‚¬ë¬´ì‹¤ íŒŒì¼ ìˆë‚˜?": {
      "main": [
        [
          {
            "node": "ì‚¬ë¬´ì‹¤ ìœ„ì¹˜ íƒœê·¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë™êµë™ íŒŒì¼ ìˆë‚˜?": {
      "main": [
        [
          {
            "node": "ë™êµë™ ìœ„ì¹˜ íƒœê·¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¸ì‚¬ë™ íŒŒì¼ ìˆë‚˜?": {
      "main": [
        [
          {
            "node": "ì¸ì‚¬ë™ ìœ„ì¹˜ íƒœê·¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "êµ¬ë¡œ íŒŒì¼ ìˆë‚˜?": {
      "main": [
        [
          {
            "node": "êµ¬ë¡œ ìœ„ì¹˜ íƒœê·¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì—°ë‚¨ë™ íŒŒì¼ ìˆë‚˜?": {
      "main": [
        [
          {
            "node": "ì—°ë‚¨ë™ ìœ„ì¹˜ íƒœê·¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì‚¬ë¬´ì‹¤ ìœ„ì¹˜ íƒœê·¸": {
      "main": [
        [
          {
            "node": "ëª¨ë“  ë§¤ì¥ í†µí•©",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë™êµë™ ìœ„ì¹˜ íƒœê·¸": {
      "main": [
        [
          {
            "node": "ëª¨ë“  ë§¤ì¥ í†µí•©",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "ì¸ì‚¬ë™ ìœ„ì¹˜ íƒœê·¸": {
      "main": [
        [
          {
            "node": "ëª¨ë“  ë§¤ì¥ í†µí•©",
            "type": "main",
            "index": 2
          }
        ]
      ]
    },
    "êµ¬ë¡œ ìœ„ì¹˜ íƒœê·¸": {
      "main": [
        [
          {
            "node": "ëª¨ë“  ë§¤ì¥ í†µí•©",
            "type": "main",
            "index": 3
          }
        ]
      ]
    },
    "ì—°ë‚¨ë™ ìœ„ì¹˜ íƒœê·¸": {
      "main": [
        [
          {
            "node": "ëª¨ë“  ë§¤ì¥ í†µí•©",
            "type": "main",
            "index": 4
          }
        ]
      ]
    },
    "ëª¨ë“  ë§¤ì¥ í†µí•©": {
      "main": [
        [
          {
            "node": "ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì˜ìˆ˜ì¦ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ": {
      "main": [
        [
          {
            "node": "GPT-4oë¡œ OCR ì²˜ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GPT-4oë¡œ OCR ì²˜ë¦¬": {
      "main": [
        [
          {
            "node": "OCR ê²°ê³¼ íŒŒì‹±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OCR ê²°ê³¼ íŒŒì‹±": {
      "main": [
        [
          {
            "node": "ì²˜ë¦¬ ì„±ê³µí•œ ê²ƒë§Œ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì²˜ë¦¬ ì„±ê³µí•œ ê²ƒë§Œ": {
      "main": [
        [
          {
            "node": "AI ê³„ì •ê³¼ëª© ë¶„ë¥˜",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ì‹¤íŒ¨ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI ê³„ì •ê³¼ëª© ë¶„ë¥˜": {
      "main": [
        [
          {
            "node": "ìµœì¢… ë°ì´í„° ì •ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ìµœì¢… ë°ì´í„° ì •ë¦¬": {
      "main": [
        [
          {
            "node": "êµ¬ê¸€ ì‹œíŠ¸ ê¸°ë¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "êµ¬ê¸€ ì‹œíŠ¸ ê¸°ë¡": {
      "main": [
        [
          {
            "node": "íŒŒì¼ëª… ë³€ê²½",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "íŒŒì¼ëª… ë³€ê²½": {
      "main": [
        [
          {
            "node": "ì™„ë£Œí´ë”ë¡œ ì´ë™",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì™„ë£Œí´ë”ë¡œ ì´ë™": {
      "main": [
        [
          {
            "node": "í…”ë ˆê·¸ë¨ ì•Œë¦¼",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "12a34567-89ab-cdef-0123-456789abcdef",
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "id": "98",
  "tags": [
    {
      "createdAt": "2024-12-15T10:30:00.000Z",
      "updatedAt": "2024-12-15T10:30:00.000Z",
      "id": "15",
      "name": "ì˜ìˆ˜ì¦ì²˜ë¦¬"
    },
    {
      "createdAt": "2024-12-15T10:30:00.000Z", 
      "updatedAt": "2024-12-15T10:30:00.000Z",
      "id": "16",
      "name": "íšŒê³„ìë™í™”"
    }
  ]
}