# Receipt Processor 워크플로우 분석

> 5개 카페 사업장의 영수증 자동 처리 시스템

## 📋 워크플로우 개요

### 기본 정보
- **워크플로우명**: 영수증 처리기 - 5개 사업장
- **목적**: 5개 카페 사업장의 영수증 자동 OCR, AI 분류, 회계 처리
- **실행 주기**: 각 사업장별 10분마다 자동 실행
- **AI 모델**: GPT-4o-mini (OCR + 계정과목 분류)
- **연동 시스템**: Google Drive, Google Sheets, Telegram

### 처리 대상 사업장
1. **사무실** (`office`)
2. **동교동** (`donggyo`) 
3. **인사동** (`insadong`)
4. **구로** (`guro`)
5. **연남동** (`yeonnam`)

## 🏗 워크플로우 구조

### 1단계: 트리거 및 파일 검색 (5개 병렬)
```
각 사업장별 스케줄 트리거 (10분마다)
    ↓
Google Drive에서 새로운 영수증 이미지 검색
    ↓
파일 존재 여부 확인 (IF 조건)
    ↓
사업장별 위치 태그 추가
```

### 2단계: 통합 처리
```
5개 사업장 데이터 통합 (Merge)
    ↓
영수증 이미지 다운로드
    ↓
GPT-4o OCR 처리
    ↓
OCR 결과 JSON 파싱
    ↓
성공/실패 분기 처리
```

### 3단계: AI 분류 및 기록
```
AI 계정과목 분류 (GPT-4o-mini)
    ↓
최종 데이터 구조화
    ↓
Google Sheets 기록
    ↓
파일명 자동 변경
    ↓
완료 폴더로 이동
    ↓
Telegram 알림 발송
```

## 🤖 AI 처리 상세

### OCR 처리 (GPT-4o)
**추출 정보**:
- 날짜 (YYYY-MM-DD)
- 상호명
- 사업자등록번호
- 총금액/세금금액
- 품목 상세 (품명, 수량, 단가)
- 결제방법

**프롬프트 설계**:
- JSON 형태로 구조화된 데이터 추출
- 불분명한 부분은 "확인불가" 처리
- 숫자 데이터는 숫자만 추출

### 계정과목 분류 (GPT-4o-mini)
**9개 계정과목**:
1. **식재료비** - 커피원두, 우유, 시럽, 베이커리 재료
2. **부재료비** - 설탕, 빨대, 냅킨, 컵홀더 등 소모성 부자재  
3. **포장재비** - 일회용 컵, 뚜껑, 포장지, 쇼핑백
4. **운반비** - 배송비, 택배비, 운송료
5. **수도광열비** - 전기료, 가스료, 상하수도료
6. **소모품비** - 청소용품, 사무용품, 매장 관리용품
7. **수선비** - 장비수리, 인테리어 보수, 기계점검
8. **광고선전비** - 마케팅, 광고, 홍보물 제작
9. **기타** - 위 8개에 해당하지 않는 모든 비용

**분류 로직**:
- 상호명, 구매품목, 사업장 정보를 종합적으로 고려
- 카페 운영 전문가 페르소나로 정확한 분류
- 숫자만 반환하여 매핑 테이블로 변환

## 📊 데이터 관리

### Google Sheets 기록 항목
| 컬럼 | 내용 | 예시 |
|------|------|------|
| A | 처리일 | 2024-12-15 |
| B | 사업장 | 동교동 |
| C | 영수증일자 | 2024-12-14 |
| D | 상호명 | 스타벅스 |
| E | 계정과목 | 식재료비 |
| F | 금액 | 15000 |
| G | 세액 | 1500 |
| H | 결제방법 | 카드 |
| I | 파일명 | receipt_001.jpg |
| J | 사업자번호 | 123-45-67890 |

### 파일 관리 시스템
**자동 파일명 변경**:
```
{처리일자}_{사업장코드}_{계정과목}_{금액}원_{원본파일명}

예시: 2024-12-15_donggyo_식재료비_15000원_receipt_001.jpg
```

**폴더 구조**:
```
각 사업장별 Google Drive
├── 처리대기/          # 새로운 영수증 업로드
└── 처리완료/          # AI 처리 완료된 영수증
```

## 🔔 알림 시스템

### 성공 알림 (Telegram)
```
🧾 영수증 처리 완료

📍 동교동
📅 영수증일자: 2024-12-14  
🏪 상호: 스타벅스
💰 금액: 15,000원
📊 계정과목: 식재료비
📎 파일: receipt_001.jpg

⏰ 2024-12-15 14:30:25 처리완료
```

### 실패 알림 (Telegram)
```
⚠️ 영수증 처리 실패

📍 동교동
📎 파일: receipt_002.jpg  
❌ 오류: JSON 형식을 찾을 수 없습니다

🔧 수동 확인이 필요합니다.
```

## 📈 현재 성과 및 운영 현황

### 처리 성능
- **실행 주기**: 10분마다 (1일 144회 체크)
- **동시 처리**: 최대 5개 사업장 병렬 처리
- **예상 처리량**: 일평균 20-30개 영수증
- **분류 정확도**: 추정 85-90% (회계 전문가 페르소나 활용)

### 업무 효율화 효과
- **수동 입력 시간**: 영수증 1개당 3-5분 → 자동화
- **분류 오류 감소**: 사람의 실수 → AI 일관성
- **실시간 처리**: 즉시 회계 데이터 반영
- **감사 추적**: 모든 처리 과정 로그 보존

## 🔧 기술적 특징

### 에러 핸들링
- **OCR 실패 시**: "확인불가" 처리 + 실패 알림
- **JSON 파싱 오류**: 구조화된 에러 메시지
- **파일 처리 실패**: Telegram으로 즉시 알림
- **Google API 오류**: 자동 재시도 로직

### 데이터 무결성
- **중복 처리 방지**: 파일명 기준 중복 체크
- **트랜잭션 처리**: 시트 기록 → 파일명 변경 → 폴더 이동 순서
- **백업 보존**: 원본 이미지는 완료 폴더에 보관
- **감사 로그**: 모든 처리 과정 타임스탬프 기록

## 🎯 Claude Code 연동 계획

### Phase 1: 정확도 향상
- **`ai-business-architect`** 에이전트로 계정과목 분류 정확도 95% 이상 달성
- 카페 운영 15년 경험 데이터를 활용한 분류 로직 고도화
- 예외 케이스 패턴 학습 및 자동 대응

### Phase 2: 프로세스 최적화  
- **`n8n-workflow-builder`** 에이전트로 워크플로우 구조 최적화
- 병렬 처리 성능 개선
- 에러 복구 메커니즘 강화

### Phase 3: 인사이트 생성
- 사업장별 지출 패턴 분석
- 월간/분기별 회계 리포트 자동 생성
- 비용 최적화 인사이트 제공

## 🚀 개선 계획

### 단기 개선 (1-2주)
- [ ] 계정과목 분류 정확도 측정 및 개선
- [ ] 처리 실패 케이스 분석 및 대응
- [ ] OCR 정확도 향상을 위한 이미지 전처리

### 중기 개선 (1-2개월)
- [ ] 월간 회계 리포트 자동 생성
- [ ] 사업장별 지출 대시보드 구축
- [ ] 예외 처리 규칙 확장

### 장기 개선 (3-6개월)
- [ ] 예측 회계 시스템 구축
- [ ] 세무 신고 자료 자동 생성
- [ ] Claude Code와 완전 통합

---

*5개 사업장의 영수증을 10분마다 자동으로 처리하여 회계 업무를 완전 자동화하는 차세대 시스템입니다. GPT-4o OCR + AI 분류로 정확도를 높이고, Claude Code 연동으로 더욱 지능적인 처리가 가능해집니다.*

## Related Notes
- [[learning-roadmap]] - 높은 연관성
- [[personal-tone-version]] - 높은 연관성
- [[system-vs-tool-master]] - 높은 연관성
- [[final-seo-version]] - 높은 연관성
- [[pkm-sustainability]] - 높은 연관성
- [[business-operations-hub]] - 높은 연관성
- [[menu-development-hub]] - 높은 연관성
