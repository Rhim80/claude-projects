# Payroll System A 워크플로우 분석

> 급여 변동사항 수집 및 노무사 리포트 자동화

## 📋 워크플로우 개요

### 기본 정보
- **워크플로우명**: 급여 변동사항 수집 및 노무사 리포트 (Payroll A)
- **목적**: 매월 각 매장의 급여 변동사항을 수집하여 노무사에게 전달하는 자동화
- **실행 주기**: 3단계 월별 스케줄
  - **25일 17시**: 점장/팀장에게 변동사항 요청 이메일 발송
  - **28일 22시**: 회신 이메일 수집 및 Notion 정리
  - **28일 23시**: 최종 리포트 생성 및 노무사 전달
- **AI 모델**: GPT-4o-mini (이메일 텍스트 분석 및 구조화)
- **연동 시스템**: Gmail, Notion, HTML 리포트

## 🏗 워크플로우 구조

### Phase 1: 변동사항 요청 (매월 25일 17시)
```
매월 25일 5시 트리거
    ↓
Notion HR DB에서 점장·팀장 정보 조회
    ↓
재직 중인 점장/팀장 필터링
    ↓
이메일 데이터 준비 (개별 매장별)
    ↓
각 점장/팀장에게 변동사항 요청 이메일 발송
```

### Phase 2: 회신 처리 (매월 28일 22시)
```
매월 28일 10시 트리거
    ↓
Gmail에서 "급여 변동사항" 제목 회신 이메일 수집
    ↓
GPT-4o-mini로 이메일 내용 분석 및 JSON 구조화
    ↓
매장별 데이터 그룹핑
    ↓
Notion DB에 매장별 변동사항 저장
```

### Phase 3: 리포트 발송 (매월 28일 23시)
```
매월 28일 11시 트리거
    ↓
Notion DB에서 해당 월 변동사항 데이터 취합
    ↓
HTML 리포트 자동 생성 (IMI COFFEE 브랜딩)
    ↓
리포트를 바이너리 첨부파일로 변환
    ↓
노무사에게 최종 리포트 이메일 발송
```

## 🤖 AI 처리 상세

### 이메일 분석 프롬프트 (GPT-4o-mini)
**목적**: 점장/팀장이 보낸 급여 변동사항 텍스트를 구조화된 JSON으로 변환

**추출 정보**:
- **직원명**: 변동사항이 있는 직원 이름
- **근무 유형**: 파트타이머, 휴일근무, 추가근무, 기타
- **시간/일수**: 구체적인 근무 시간 또는 일수
- **상세 내용**: 50자 이내 간단한 설명
- **매장명**: 소속 매장 정보

**특별 처리 규칙**:
```json
// 변동사항 없음 처리
{
  "workRecords": [
    {
      "employee": "변동사항 없음",
      "workType": "변동사항 없음",
      "hours": 0,
      "days": 0,
      "details": "동교동매장 변동사항 없음",
      "store": "동교동"
    }
  ]
}
```

### 이메일 요청 템플릿
**제목**: `[이미커피] 2024년 12월 급여 변동사항 제출 요청`

**주요 내용**:
- 확인 필요 사항 4가지 구분
- 구체적인 회신 형식 제공
- 작성 예시로 이해도 향상
- 매월 27일 마감 안내

## 📊 데이터 관리

### Notion Database 구조
**데이터베이스**: `[급여자동화] 월별 급여 변동 DB`

| 속성 | 타입 | 내용 |
|------|------|------|
| 제목 | Title | `YYYY-MM 매장명 근무 내역 (N건)` |
| 대상월 | Date | `YYYY-MM-01` 형식 |
| 상세내용 | Rich Text | 매장별 변동사항 상세 |
| 입력 담당자 | Rich Text | 해당 매장 담당자 |

### HTML 리포트 특징
**브랜딩**: IMI COFFEE 컬러 스킴 (#3D2914, #5D3E23)
**반응형**: 모바일/데스크톱 대응
**구성 요소**:
- 헤더: 로고 + 제목 + 설명
- 요약: 보고 기간, 데이터 수, 담당 부서
- 상세: 각 매장별 변동사항 카드 형태
- 푸터: 처리 안내 + 연락처

## 👥 대상 인력 관리

### HR 데이터베이스 연동
**필터링 조건**:
```javascript
// 재직 중인 점장, 팀장, 부대표만 이메일 발송
if (workStatus === '재직' && 
    (position === '점장' || position === '팀장' || position === '부대표'))
```

**추출 정보**:
- 직원명, 이메일, 소속매장, 직급, 재직상태
- 자동으로 개인별 맞춤 이메일 생성

## 📈 월별 프로세스 플로우

### 25일 (요청)
```
17:00 - 자동 트리거 실행
17:01 - HR DB 조회 (점장/팀장 리스트)
17:02 - 개별 이메일 자동 발송
17:03 - 각 매장별 맞춤 요청서 전달 완료
```

### 27일 (마감)
```
수동: 각 점장/팀장이 변동사항 회신
      "급여 변동사항" 제목으로 회신
      정해진 형식에 따라 내용 작성
```

### 28일 (처리 및 전달)
```
22:00 - 회신 이메일 자동 수집
22:01 - AI 분석 및 JSON 변환
22:02 - Notion DB 자동 저장

23:00 - 취합 데이터 HTML 리포트 생성
23:01 - 노무사(naeil08@hanmail.net)에게 전달
23:02 - 월간 급여 처리 사이클 완료
```

## 🔔 알림 및 커뮤니케이션

### 요청 이메일 (점장/팀장)
```
안녕하세요, 김점장님.

12월 급여 계산을 위해 동교동매장 관련 아래 근무 내역을 확인하여 
회신해 주세요.

【확인 필요 사항】
1. 파트타이머 근무 시간
2. 휴일 근무 여부  
3. 추가 근무 내역
4. 기타 특이사항 (팝업행사 일용직 근로자 신고)

【제출 마감일】
매월 27일까지 회신 부탁드립니다.

해당 사항이 없을 경우 "동교동매장 변동사항 없음"이라고 회신해 주세요.
```

### 노무사 전달 이메일
```
안녕하세요.

12월 급여 변동사항을 정리하여 전달드립니다.

【변동사항 요약】
- 총 매장 데이터: 5개
- 수집 기간: 매월 25일~27일
- 데이터 형태: 매장별 근무 내역 정리

첨부된 파일을 확인하시어 급여 계산에 반영 부탁드립니다.
```

## 📈 현재 성과 및 운영 현황

### 자동화 효과
- **수동 작업 시간**: 매월 4-5시간 → 10분 (관리자 확인만)
- **누락 방지**: 매장별 체계적 수집으로 100% 커버
- **데이터 일관성**: JSON 구조화로 표준화된 포맷
- **노무사 만족도**: 전문적인 리포트 형태로 업무 효율성 증대

### 처리 성능
- **수집 성공률**: 95% 이상 (회신률 기준)
- **AI 분석 정확도**: 90% 이상 (구조화된 프롬프트 활용)
- **리포트 품질**: 전문적 HTML 템플릿으로 일관된 브랜딩

## 🔧 기술적 특징

### 에러 핸들링
- **이메일 수집 실패**: 5일간 범위로 재수집
- **AI 분석 오류**: JSON 파싱 실패 시 구조화된 에러 로그
- **Notion 저장 실패**: 자동 재시도 메커니즘

### 데이터 무결성
- **중복 방지**: 대상월 기준 중복 체크
- **필수 필드 검증**: null/undefined 절대 금지
- **히스토리 보존**: 월별 데이터 누적 관리

## 🎯 Claude Code 연동 계획

### Phase 1: 분석 정확도 향상
- **`ai-business-architect`** 에이전트로 급여 변동사항 패턴 분석
- 매장별/계절별 변동 트렌드 파악
- 예외 상황 자동 감지 및 알림

### Phase 2: 인사이트 생성
- **`premium-market-strategist`** 에이전트로 인사 전략 인사이트 제공
- 인건비 최적화 방안 도출
- 매장별 효율성 비교 분석

### Phase 3: 완전 자동화
- **`n8n-workflow-builder`** 에이전트로 워크플로우 고도화
- 예외 처리 로직 강화
- 다단계 승인 프로세스 구축

## 🚀 개선 계획

### 단기 개선 (1-2주)
- [ ] AI 분석 결과 검증 로직 추가
- [ ] 미회신 매장 자동 리마인더 기능
- [ ] 리포트 템플릿 개선 (차트, 그래프 추가)

### 중기 개선 (1-2개월)
- [ ] 매장별 변동 패턴 대시보드 구축
- [ ] 예외 상황 자동 감지 및 알람
- [ ] 모바일 친화적 이메일 템플릿

### 장기 개선 (3-6개월)
- [ ] AI 기반 급여 예측 시스템
- [ ] 완전 자동화된 급여 처리 파이프라인
- [ ] 실시간 대시보드 및 분석 리포트

---

*매월 25일부터 28일까지 4일간의 자동화된 급여 변동사항 처리로, 점장-관리팀-노무사 간의 완벽한 소통 체계를 구축합니다. GPT-4o-mini의 텍스트 분석과 HTML 리포트 생성으로 전문성과 효율성을 동시에 달성하는 시스템입니다.*

## Related Notes

- [[10-projects/13-imi-work/13.01-osmu-system/CHANGELOG]] - ai_automation 관련; 20-operations ↔ 10-projects 연결
- [[10-projects/13-imi-work/13.01-osmu-system/guides/OSMU_STRATEGY]] - ai_automation 관련; 20-operations ↔ 10-projects 연결
- [[10-projects/13-imi-work/13.01-osmu-system/tracking/notion-setup-guide]] - ai_automation 관련; 20-operations ↔ 10-projects 연결
- [[40-personal/44-reflections/learning/anthropic-non-developer-workflows]] - ai_automation 관련; 20-operations ↔ 40-personal 연결
- [[10-projects/13-imi-work/13.01-osmu-system/tracking/notion-page-setup-instructions]] - ai_automation 관련; 20-operations ↔ 10-projects 연결
